import{Bb as u,Cb as f,Db as k,Fb as n,a as m,da as p,ea as g,nb as h,yb as v}from"./chunk-IYURAQ6S.mjs";var P=m("avatar").parts("root","image","fallback"),c=P.build(),b=t=>t.ids?.root??`avatar:${t.id}`,y=t=>t.ids?.image??`avatar:${t.id}:image`,A=t=>t.ids?.fallback??`avatar:${t.id}:fallback`,C=t=>t.getById(b(t)),l=t=>t.getById(y(t));function E(t,e){let{state:a,send:r,prop:s,scope:o}=t,i=a.matches("loaded");return{loaded:i,setSrc(H){l(o)?.setAttribute("src",H)},setLoaded(){r({type:"img.loaded",src:"api"})},setError(){r({type:"img.error",src:"api"})},getRootProps(){return e.element({...c.root.attrs,dir:s("dir"),id:b(o)})},getImageProps(){return e.img({...c.image.attrs,hidden:!i,dir:s("dir"),id:y(o),"data-state":i?"visible":"hidden",onLoad(){r({type:"img.loaded",src:"element"})},onError(){r({type:"img.error",src:"element"})}})},getFallbackProps(){return e.element({...c.fallback.attrs,dir:s("dir"),id:A(o),hidden:i,"data-state":i?"hidden":"visible"})}}}var S={initialState(){return"loading"},effects:["trackImageRemoval","trackSrcChange"],on:{"src.change":{target:"loading"},"img.unmount":{target:"error"}},states:{loading:{entry:["checkImageStatus"],on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]},"img.error":{target:"error",actions:["invokeOnError"]}}},error:{on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]}}},loaded:{on:{"img.error":{target:"error",actions:["invokeOnError"]}}}},implementations:{actions:{invokeOnLoad({prop:t}){t("onStatusChange")?.({status:"loaded"})},invokeOnError({prop:t}){t("onStatusChange")?.({status:"error"})},checkImageStatus({send:t,scope:e}){let a=l(e);if(!a?.complete)return;let r=I(a)?"img.loaded":"img.error";t({type:r,src:"ssr"})}},effects:{trackImageRemoval({send:t,scope:e}){let a=C(e);return g(a,{callback(r){Array.from(r[0].removedNodes).find(i=>i.nodeType===Node.ELEMENT_NODE&&i.matches("[data-scope=avatar][data-part=image]"))&&t({type:"img.unmount"})}})},trackSrcChange({send:t,scope:e}){let a=l(e);return p(a,{attributes:["src","srcset"],callback(){t({type:"src.change"})}})}}}};function I(t){return t.complete&&t.naturalWidth!==0&&t.naturalHeight!==0}var L=v()(["dir","id","ids","onStatusChange","getRootNode"]),j=h(L);var d=class extends k{initMachine(e){return new f(S,e)}initApi(){return E(this.machine.service,u)}render(){let e=this.el.querySelector('[data-scope="avatar"][data-part="root"]')??this.el;this.spreadProps(e,this.api.getRootProps());let a=this.el.querySelector('[data-scope="avatar"][data-part="image"]');a&&this.spreadProps(a,this.api.getImageProps());let r=this.el.querySelector('[data-scope="avatar"][data-part="fallback"]');r&&this.spreadProps(r,this.api.getFallbackProps())}};var V={mounted(){let t=this.el,e=n(t,"src"),a=new d(t,{id:t.id,onStatusChange:r=>{let s=n(t,"onStatusChange");s&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(s,{status:r.status,id:t.id});let o=n(t,"onStatusChangeClient");o&&t.dispatchEvent(new CustomEvent(o,{bubbles:!0,detail:{value:r,id:t.id}}))},...e!==void 0?{}:{}});a.init(),this.avatar=a,e!==void 0&&a.api.setSrc(e),this.handlers=[]},updated(){let t=n(this.el,"src");t!==void 0&&this.avatar&&this.avatar.api.setSrc(t)},destroyed(){if(this.handlers)for(let t of this.handlers)this.removeHandleEvent(t);this.avatar?.destroy()}};export{V as Avatar};
