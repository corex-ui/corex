import{a as O}from"./chunk-L4HS2GN2.mjs";import{B as p,P as v,Sa as g,ba as m,ca as B,f,k as l,l as h,qb as E,va as k,za as x}from"./chunk-IYURAQ6S.mjs";function q(e,t){let n=s=>{s.key==="Escape"&&(s.isComposing||t?.(s))};return v(h(e),"keydown",n,{capture:!0})}var P="layer:request-dismiss",a={layers:[],branches:[],recentlyRemoved:new Set,count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){let t=this.indexOf(e),n=this.topMostPointerBlockingLayer()?this.indexOf(this.topMostPointerBlockingLayer()?.node):-1;return t<n},isTopMost(e){return this.layers[this.count()-1]?.node===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},getLayersByType(e){return this.layers.filter(t=>t.type===e)},getNestedLayersByType(e,t){let n=this.indexOf(e);return n===-1?[]:this.layers.slice(n+1).filter(s=>s.type===t)},getParentLayerOfType(e,t){let n=this.indexOf(e);if(!(n<=0))return this.layers.slice(0,n).reverse().find(s=>s.type===t)},countNestedLayersOfType(e,t){return this.getNestedLayersByType(e,t).length},isInNestedLayer(e,t){return!!(this.getNestedLayers(e).some(s=>l(s.node,t))||this.recentlyRemoved.size>0)},isInBranch(e){return Array.from(this.branches).some(t=>l(t,e))},add(e){this.layers.push(e),this.syncLayers()},addBranch(e){this.branches.push(e)},remove(e){let t=this.indexOf(e);t<0||(this.recentlyRemoved.add(e),B(()=>this.recentlyRemoved.delete(e)),t<this.count()-1&&this.getNestedLayers(e).forEach(s=>a.dismiss(s.node,e)),this.layers.splice(t,1),this.syncLayers())},removeBranch(e){let t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},syncLayers(){this.layers.forEach((e,t)=>{e.node.style.setProperty("--layer-index",`${t}`),e.node.removeAttribute("data-nested"),e.node.removeAttribute("data-has-nested"),this.getParentLayerOfType(e.node,e.type)&&e.node.setAttribute("data-nested",e.type);let s=this.countNestedLayersOfType(e.node,e.type);s>0&&e.node.setAttribute("data-has-nested",e.type),e.node.style.setProperty("--nested-layer-count",`${s}`)})},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e,t){let n=this.indexOf(e);if(n===-1)return;let s=this.layers[n];C(e,P,i=>{s.requestDismiss?.(i),i.defaultPrevented||s?.dismiss()}),_(e,P,{originalLayer:e,targetLayer:t,originalIndex:n,targetIndex:t?this.indexOf(t):-1}),this.syncLayers()},clear(){this.remove(this.layers[0].node)}};function _(e,t,n){let s=e.ownerDocument.defaultView||window,i=new s.CustomEvent(t,{cancelable:!0,bubbles:!0,detail:n});return e.dispatchEvent(i)}function C(e,t,n){e.addEventListener(t,n,{once:!0})}var w;function D(){a.layers.forEach(({node:e})=>{e.style.pointerEvents=a.isBelowPointerBlockingLayer(e)?"none":"auto"})}function K(e){e.style.pointerEvents=""}function z(e,t){let n=h(e),s=[];return a.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(w=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),t?.forEach(i=>{let[o,d]=x(()=>{let c=i();return f(c)?c:null},{timeout:1e3});o.then(c=>s.push(k(c,{pointerEvents:"auto"}))),s.push(d)}),()=>{a.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=w,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),s.forEach(i=>i()))}}function j(e,t){let{warnOnMissingNode:n=!0}=t;if(n&&!e){E("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!e)return;let{onDismiss:s,onRequestDismiss:i,pointerBlocking:o,exclude:d,debug:c,type:T="dialog"}=t,I={dismiss:s,node:e,type:T,pointerBlocking:o,requestDismiss:i};a.add(I),D();function A(r){let u=p(r.detail.originalEvent);a.isBelowPointerBlockingLayer(e)||a.isInBranch(u)||(t.onPointerDownOutside?.(r),t.onInteractOutside?.(r),!r.defaultPrevented&&(c&&console.log("onPointerDownOutside:",r.detail.originalEvent),s?.()))}function N(r){let u=p(r.detail.originalEvent);a.isInBranch(u)||(t.onFocusOutside?.(r),t.onInteractOutside?.(r),!r.defaultPrevented&&(c&&console.log("onFocusOutside:",r.detail.originalEvent),s?.()))}function M(r){a.isTopMost(e)&&(t.onEscapeKeyDown?.(r),!r.defaultPrevented&&s&&(r.preventDefault(),s()))}function S(r){if(!e)return!1;let u=typeof d=="function"?d():d,L=Array.isArray(u)?u:[u],b=t.persistentElements?.map(y=>y()).filter(f);return b&&L.push(...b),L.some(y=>l(y,r))||a.isInNestedLayer(e,r)}let R=[o?z(e,t.persistentElements):void 0,q(e,M),O(e,{exclude:S,onFocusOutside:N,onPointerDownOutside:A,defer:t.defer})];return()=>{a.remove(e),D(),K(e),R.forEach(r=>r?.())}}function H(e,t){let{defer:n}=t,s=n?m:o=>o(),i=[];return i.push(s(()=>{let o=g(e)?e():e;i.push(j(o,t))})),()=>{i.forEach(o=>o?.())}}function Q(e,t={}){let{defer:n}=t,s=n?m:o=>o(),i=[];return i.push(s(()=>{let o=g(e)?e():e;if(!o){E("[@zag-js/dismissable] branch node is `null` or `undefined`");return}a.addBranch(o),i.push(()=>{a.removeBranch(o)})})),()=>{i.forEach(o=>o?.())}}export{H as a,Q as b};
