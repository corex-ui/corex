import{Bb as E,Cb as P,Db as V,Fb as s,Hb as v,Ib as m,Q as f,a as b,d as p,m as C,nb as u,pb as y,yb as h}from"./chunk-IYURAQ6S.mjs";var k=b("clipboard").parts("root","control","trigger","indicator","input","label"),d=k.build(),w=e=>e.ids?.root??`clip:${e.id}`,g=e=>e.ids?.input??`clip:${e.id}:input`,H=e=>e.ids?.label??`clip:${e.id}:label`,L=e=>e.getById(g(e)),I=(e,t)=>_(e.getDoc(),t);function O(e,t){let o=e.createElement("pre");return Object.assign(o.style,{width:"1px",height:"1px",position:"fixed",top:"5px"}),o.textContent=t,o}function x(e){let o=C(e).getSelection();if(o==null)return Promise.reject(new Error);o.removeAllRanges();let i=e.ownerDocument,r=i.createRange();return r.selectNodeContents(e),o.addRange(r),i.execCommand("copy"),o.removeAllRanges(),Promise.resolve()}function _(e,t){let o=e.defaultView||window;if(o.navigator.clipboard?.writeText!==void 0)return o.navigator.clipboard.writeText(t);if(!e.body)return Promise.reject(new Error);let i=O(e,t);return e.body.appendChild(i),x(i),e.body.removeChild(i),Promise.resolve()}function S(e,t){let{state:o,send:i,context:r,scope:a}=e,n=o.matches("copied");return{copied:n,value:r.get("value"),setValue(l){i({type:"VALUE.SET",value:l})},copy(){i({type:"COPY"})},getRootProps(){return t.element({...d.root.attrs,"data-copied":p(n),id:w(a)})},getLabelProps(){return t.label({...d.label.attrs,htmlFor:g(a),"data-copied":p(n),id:H(a)})},getControlProps(){return t.element({...d.control.attrs,"data-copied":p(n)})},getInputProps(){return t.input({...d.input.attrs,defaultValue:r.get("value"),"data-copied":p(n),readOnly:!0,"data-readonly":"true",id:g(a),onFocus(l){l.currentTarget.select()},onCopy(){i({type:"INPUT.COPY"})}})},getTriggerProps(){return t.button({...d.trigger.attrs,type:"button","aria-label":n?"Copied to clipboard":"Copy to clipboard","data-copied":p(n),onClick(){i({type:"COPY"})}})},getIndicatorProps(l){return t.element({...d.indicator.attrs,hidden:l.copied!==n})}}}var T={props({props:e}){return{timeout:3e3,defaultValue:"",...e}},initialState(){return"idle"},context({prop:e,bindable:t}){return{value:t(()=>({defaultValue:e("defaultValue"),value:e("value"),onChange(o){e("onValueChange")?.({value:o})}}))}},watch({track:e,context:t,action:o}){e([()=>t.get("value")],()=>{o(["syncInputElement"])})},on:{"VALUE.SET":{actions:["setValue"]},COPY:{target:"copied",actions:["copyToClipboard","invokeOnCopy"]}},states:{idle:{on:{"INPUT.COPY":{target:"copied",actions:["invokeOnCopy"]}}},copied:{effects:["waitForTimeout"],on:{"COPY.DONE":{target:"idle"},COPY:{target:"copied",actions:["copyToClipboard","invokeOnCopy"]},"INPUT.COPY":{actions:["invokeOnCopy"]}}}},implementations:{effects:{waitForTimeout({prop:e,send:t}){return y(()=>{t({type:"COPY.DONE"})},e("timeout"))}},actions:{setValue({context:e,event:t}){e.set("value",t.value)},copyToClipboard({context:e,scope:t}){I(t,e.get("value"))},invokeOnCopy({prop:e}){e("onStatusChange")?.({copied:!0})},syncInputElement({context:e,scope:t}){let o=L(t);o&&f(o,e.get("value"))}}}},A=h()(["getRootNode","id","ids","value","defaultValue","timeout","onStatusChange","onValueChange"]),D=u(A),M=h()(["copied"]),q=u(M);var c=class extends V{initMachine(t){return new P(T,t)}initApi(){return S(this.machine.service,E)}render(){let t=this.el.querySelector('[data-scope="clipboard"][data-part="root"]');if(t){this.spreadProps(t,this.api.getRootProps());let o=t.querySelector('[data-scope="clipboard"][data-part="label"]');o&&this.spreadProps(o,this.api.getLabelProps());let i=t.querySelector('[data-scope="clipboard"][data-part="control"]');if(i){this.spreadProps(i,this.api.getControlProps());let r=i.querySelector('[data-scope="clipboard"][data-part="input"]');if(r){let n={...this.api.getInputProps()},l=this.el.dataset.inputAriaLabel;l&&(n["aria-label"]=l),this.spreadProps(r,n)}let a=i.querySelector('[data-scope="clipboard"][data-part="trigger"]');if(a){let n={...this.api.getTriggerProps()},l=this.el.dataset.triggerAriaLabel;l&&(n["aria-label"]=l),this.spreadProps(a,n)}}}}};var K={mounted(){let e=this.el,t=this.pushEvent.bind(this),o=this.liveSocket,i=new c(e,{id:e.id,timeout:v(e,"timeout"),...m(e,"controlled")?{value:s(e,"value")}:{defaultValue:s(e,"defaultValue")},onValueChange:r=>{let a=s(e,"onValueChange");a&&o.main.isConnected()&&t(a,{id:e.id,value:r.value??null})},onStatusChange:r=>{let a=s(e,"onStatusChange");a&&o.main.isConnected()&&t(a,{id:e.id,copied:r.copied});let n=s(e,"onStatusChangeClient");n&&e.dispatchEvent(new CustomEvent(n,{bubbles:!0}))}});i.init(),this.clipboard=i,this.onCopy=()=>{i.api.copy()},e.addEventListener("phx:clipboard:copy",this.onCopy),this.onSetValue=r=>{let{value:a}=r.detail;i.api.setValue(a)},e.addEventListener("phx:clipboard:set-value",this.onSetValue),this.handlers=[],this.handlers.push(this.handleEvent("clipboard_copy",r=>{let a=r.clipboard_id;a&&a!==e.id||i.api.copy()})),this.handlers.push(this.handleEvent("clipboard_set_value",r=>{let a=r.clipboard_id;a&&a!==e.id||i.api.setValue(r.value)})),this.handlers.push(this.handleEvent("clipboard_copied",()=>{this.pushEvent("clipboard_copied_response",{value:i.api.copied})}))},updated(){this.clipboard?.updateProps({id:this.el.id,timeout:v(this.el,"timeout"),...m(this.el,"controlled")?{value:s(this.el,"value")}:{defaultValue:s(this.el,"value")},dir:s(this.el,"dir",["ltr","rtl"])})},destroyed(){if(this.onCopy&&this.el.removeEventListener("phx:clipboard:copy",this.onCopy),this.onSetValue&&this.el.removeEventListener("phx:clipboard:set-value",this.onSetValue),this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.clipboard?.destroy()}};export{K as Clipboard};
