import{a as x}from"./chunk-L4HS2GN2.mjs";import{Bb as U,Cb as j,Db as _,E as B,Eb as K,Fb as p,Ib as s,Q as N,a as R,ba as w,d as l,e as P,k as H,nb as q,x as F,yb as $}from"./chunk-IYURAQ6S.mjs";var Z=R("editable").parts("root","area","label","preview","input","editTrigger","submitTrigger","cancelTrigger","control"),g=Z.build(),ee=e=>e.ids?.root??`editable:${e.id}`,te=e=>e.ids?.area??`editable:${e.id}:area`,ie=e=>e.ids?.label??`editable:${e.id}:label`,W=e=>e.ids?.preview??`editable:${e.id}:preview`,S=e=>e.ids?.input??`editable:${e.id}:input`,re=e=>e.ids?.control??`editable:${e.id}:control`,z=e=>e.ids?.submitTrigger??`editable:${e.id}:submit`,G=e=>e.ids?.cancelTrigger??`editable:${e.id}:cancel`,J=e=>e.ids?.editTrigger??`editable:${e.id}:edit`,k=e=>e.getById(S(e)),ae=e=>e.getById(W(e)),ne=e=>e.getById(z(e)),oe=e=>e.getById(G(e)),le=e=>e.getById(J(e));function Q(e,t){let{state:i,context:u,send:a,prop:r,scope:o,computed:h}=e,c=!!r("disabled"),d=h("isInteractive"),b=!!r("readOnly"),I=!!r("required"),E=!!r("invalid"),f=!!r("autoResize"),y=r("translations"),v=i.matches("edit"),T=r("placeholder"),M=typeof T=="string"?{edit:T,preview:T}:T,C=u.get("value"),O=C.trim()==="",L=O?M?.preview??"":C;return{editing:v,empty:O,value:C,valueText:L,setValue(n){a({type:"VALUE.SET",value:n,src:"setValue"})},clearValue(){a({type:"VALUE.SET",value:"",src:"clearValue"})},edit(){d&&a({type:"EDIT"})},cancel(){d&&a({type:"CANCEL"})},submit(){d&&a({type:"SUBMIT"})},getRootProps(){return t.element({...g.root.attrs,id:ee(o),dir:r("dir")})},getAreaProps(){return t.element({...g.area.attrs,id:te(o),dir:r("dir"),style:f?{display:"inline-grid"}:void 0,"data-focus":l(v),"data-disabled":l(c),"data-placeholder-shown":l(O)})},getLabelProps(){return t.label({...g.label.attrs,id:ie(o),dir:r("dir"),htmlFor:S(o),"data-focus":l(v),"data-invalid":l(E),"data-required":l(I),onClick(){if(v)return;ae(o)?.focus({preventScroll:!0})}})},getInputProps(){return t.input({...g.input.attrs,dir:r("dir"),"aria-label":y?.input,name:r("name"),form:r("form"),id:S(o),hidden:f?void 0:!v,placeholder:M?.edit,maxLength:r("maxLength"),required:r("required"),disabled:c,"data-disabled":l(c),readOnly:b,"data-readonly":l(b),"aria-invalid":P(E),"data-invalid":l(E),"data-autoresize":l(f),defaultValue:C,size:f?1:void 0,onChange(n){a({type:"VALUE.SET",src:"input.change",value:n.currentTarget.value})},onKeyDown(n){if(n.defaultPrevented||B(n))return;let A={Escape(){a({type:"CANCEL"}),n.preventDefault()},Enter(m){if(!h("submitOnEnter"))return;let{localName:D}=m.currentTarget;if(D==="textarea"){if(!(F()?m.metaKey:m.ctrlKey))return;a({type:"SUBMIT",src:"keydown.enter"});return}D==="input"&&!m.shiftKey&&!m.metaKey&&(a({type:"SUBMIT",src:"keydown.enter"}),m.preventDefault())}}[n.key];A&&A(n)},style:f?{gridArea:"1 / 1 / auto / auto",visibility:v?void 0:"hidden"}:void 0})},getPreviewProps(){return t.element({id:W(o),...g.preview.attrs,dir:r("dir"),"data-placeholder-shown":l(O),"aria-readonly":P(b),"data-readonly":l(c),"data-disabled":l(c),"aria-disabled":P(c),"aria-invalid":P(E),"data-invalid":l(E),"aria-label":y?.edit,"data-autoresize":l(f),children:L,hidden:f?void 0:v,tabIndex:d?0:void 0,onClick(){d&&r("activationMode")==="click"&&a({type:"EDIT",src:"click"})},onFocus(){d&&r("activationMode")==="focus"&&a({type:"EDIT",src:"focus"})},onDoubleClick(n){n.defaultPrevented||d&&r("activationMode")==="dblclick"&&a({type:"EDIT",src:"dblclick"})},style:f?{whiteSpace:"pre",gridArea:"1 / 1 / auto / auto",visibility:v?"hidden":void 0,overflow:"hidden",textOverflow:"ellipsis"}:void 0})},getEditTriggerProps(){return t.button({...g.editTrigger.attrs,id:J(o),dir:r("dir"),"aria-label":y?.edit,hidden:v,type:"button",disabled:c,onClick(n){n.defaultPrevented||d&&a({type:"EDIT",src:"edit.click"})}})},getControlProps(){return t.element({id:re(o),...g.control.attrs,dir:r("dir")})},getSubmitTriggerProps(){return t.button({...g.submitTrigger.attrs,dir:r("dir"),id:z(o),"aria-label":y?.submit,hidden:!v,disabled:c,type:"button",onClick(n){n.defaultPrevented||d&&a({type:"SUBMIT",src:"submit.click"})}})},getCancelTriggerProps(){return t.button({...g.cancelTrigger.attrs,dir:r("dir"),"aria-label":y?.cancel,id:G(o),hidden:!v,type:"button",disabled:c,onClick(n){n.defaultPrevented||d&&a({type:"CANCEL",src:"cancel.click"})}})}}}var X={props({props:e}){return{activationMode:"focus",submitMode:"both",defaultValue:"",selectOnFocus:!0,...e,translations:{input:"editable input",edit:"edit",submit:"submit",cancel:"cancel",...e.translations}}},initialState({prop:e}){return e("edit")||e("defaultEdit")?"edit":"preview"},entry:["focusInputIfNeeded"],context:({bindable:e,prop:t})=>({value:e(()=>({defaultValue:t("defaultValue"),value:t("value"),onChange(i){return t("onValueChange")?.({value:i})}})),previousValue:e(()=>({defaultValue:""}))}),watch({track:e,action:t,context:i,prop:u}){e([()=>i.get("value")],()=>{t(["syncInputValue"])}),e([()=>u("edit")],()=>{t(["toggleEditing"])})},computed:{submitOnEnter({prop:e}){let t=e("submitMode");return t==="both"||t==="enter"},submitOnBlur({prop:e}){let t=e("submitMode");return t==="both"||t==="blur"},isInteractive({prop:e}){return!(e("disabled")||e("readOnly"))}},on:{"VALUE.SET":{actions:["setValue"]}},states:{preview:{entry:["blurInput"],on:{"CONTROLLED.EDIT":{target:"edit",actions:["setPreviousValue","focusInput"]},EDIT:[{guard:"isEditControlled",actions:["invokeOnEdit"]},{target:"edit",actions:["setPreviousValue","focusInput","invokeOnEdit"]}]}},edit:{effects:["trackInteractOutside"],entry:["syncInputValue"],on:{"CONTROLLED.PREVIEW":[{guard:"isSubmitEvent",target:"preview",actions:["setPreviousValue","restoreFocus","invokeOnSubmit"]},{target:"preview",actions:["revertValue","restoreFocus","invokeOnCancel"]}],CANCEL:[{guard:"isEditControlled",actions:["invokeOnPreview"]},{target:"preview",actions:["revertValue","restoreFocus","invokeOnCancel","invokeOnPreview"]}],SUBMIT:[{guard:"isEditControlled",actions:["invokeOnPreview"]},{target:"preview",actions:["setPreviousValue","restoreFocus","invokeOnSubmit","invokeOnPreview"]}]}}},implementations:{guards:{isEditControlled:({prop:e})=>e("edit")!=null,isSubmitEvent:({event:e})=>e.previousEvent?.type==="SUBMIT"},effects:{trackInteractOutside({send:e,scope:t,prop:i,computed:u}){return x(k(t),{exclude(a){return[oe(t),ne(t)].some(o=>H(o,a))},onFocusOutside:i("onFocusOutside"),onPointerDownOutside:i("onPointerDownOutside"),onInteractOutside(a){if(i("onInteractOutside")?.(a),a.defaultPrevented)return;let{focusable:r}=a.detail;e({type:u("submitOnBlur")?"SUBMIT":"CANCEL",src:"interact-outside",focusable:r})}})}},actions:{restoreFocus({event:e,scope:t,prop:i}){e.focusable||w(()=>{(i("finalFocusEl")?.()??le(t))?.focus({preventScroll:!0})})},clearValue({context:e}){e.set("value","")},focusInputIfNeeded({action:e,prop:t}){(t("edit")||t("defaultEdit"))&&e(["focusInput"])},focusInput({scope:e,prop:t}){w(()=>{let i=k(e);i&&(t("selectOnFocus")?i.select():i.focus({preventScroll:!0}))})},invokeOnCancel({prop:e,context:t}){let i=t.get("previousValue");e("onValueRevert")?.({value:i})},invokeOnSubmit({prop:e,context:t}){let i=t.get("value");e("onValueCommit")?.({value:i})},invokeOnEdit({prop:e}){e("onEditChange")?.({edit:!0})},invokeOnPreview({prop:e}){e("onEditChange")?.({edit:!1})},toggleEditing({prop:e,send:t,event:i}){t({type:e("edit")?"CONTROLLED.EDIT":"CONTROLLED.PREVIEW",previousEvent:i})},syncInputValue({context:e,scope:t}){let i=k(t);i&&N(i,e.get("value"))},setValue({context:e,prop:t,event:i}){let u=t("maxLength"),a=u!=null?i.value.slice(0,u):i.value;e.set("value",a)},setPreviousValue({context:e}){e.set("previousValue",e.get("value"))},revertValue({context:e}){let t=e.get("previousValue");t&&e.set("value",t)},blurInput({scope:e}){k(e)?.blur()}}}},de=$()(["activationMode","autoResize","dir","disabled","finalFocusEl","form","getRootNode","id","ids","invalid","maxLength","name","onEditChange","onFocusOutside","onInteractOutside","onPointerDownOutside","onValueChange","onValueCommit","onValueRevert","placeholder","readOnly","required","selectOnFocus","edit","defaultEdit","submitMode","translations","defaultValue","value"]),me=q(de);var se=["root","area","label","input","preview","edit-trigger","submit-trigger","cancel-trigger"],Y='[data-scope="editable"][data-part]',V=class extends _{initMachine(t){return new j(X,t)}initApi(){return Q(this.machine.service,U)}render(){for(let t of se){let i=t==="root"?this.el.querySelector(`${Y}[data-part="root"]`)??this.el:this.el.querySelector(`${Y}[data-part="${t}"]`);if(!i)continue;let u=this.getPartProps(t);u&&this.spreadProps(i,u)}}getPartProps(t){switch(t){case"root":return this.api.getRootProps();case"area":return this.api.getAreaProps();case"label":return this.api.getLabelProps();case"input":return this.api.getInputProps();case"preview":return this.api.getPreviewProps();case"edit-trigger":return this.api.getEditTriggerProps();case"submit-trigger":return this.api.getSubmitTriggerProps();case"cancel-trigger":return this.api.getCancelTriggerProps();default:return null}}};var Oe={mounted(){let e=this.el,t=p(e,"value"),i=p(e,"defaultValue"),u=s(e,"controlled"),a=p(e,"placeholder"),r=p(e,"activationMode"),o=s(e,"selectOnFocus"),h=new V(e,{id:e.id,...u&&t!==void 0?{value:t}:{defaultValue:i??""},disabled:s(e,"disabled"),readOnly:s(e,"readOnly"),required:s(e,"required"),invalid:s(e,"invalid"),name:p(e,"name"),form:p(e,"form"),dir:K(e),...a!==void 0?{placeholder:a}:{},...r!==void 0?{activationMode:r}:{},...o!==void 0?{selectOnFocus:o}:{},...s(e,"controlledEdit")?{edit:s(e,"edit")}:{defaultEdit:s(e,"defaultEdit")},onValueChange:c=>{let d=e.querySelector('[data-scope="editable"][data-part="input"]');d&&(d.value=c.value,d.dispatchEvent(new Event("input",{bubbles:!0})),d.dispatchEvent(new Event("change",{bubbles:!0})));let b=p(e,"onValueChange");b&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(b,{value:c.value,id:e.id});let I=p(e,"onValueChangeClient");I&&e.dispatchEvent(new CustomEvent(I,{bubbles:!0,detail:{value:c,id:e.id}}))}});h.init(),this.editable=h,this.handlers=[]},updated(){let e=p(this.el,"value"),t=s(this.el,"controlled");this.editable?.updateProps({id:this.el.id,...t&&e!==void 0?{value:e}:{},disabled:s(this.el,"disabled"),readOnly:s(this.el,"readOnly"),required:s(this.el,"required"),invalid:s(this.el,"invalid"),name:p(this.el,"name"),form:p(this.el,"form")})},destroyed(){if(this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.editable?.destroy()}};export{Oe as Editable};
