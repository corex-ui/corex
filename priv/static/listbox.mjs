import{a as ae,c as se}from"./chunk-XQAZHZIC.mjs";import{a as O,b as K,c as V,d as ne}from"./chunk-MMRG4CGO.mjs";import{B as G,Bb as le,Cb as ie,Db as oe,E as z,F as w,Fb as y,Gb as P,Ib as b,L as J,M as W,Oa as Z,a as q,ba as Y,d as f,da as Q,e as B,ha as X,j,k as $,nb as S,sb as ee,xa as F,xb as te,yb as H}from"./chunk-IYURAQ6S.mjs";var be=q("listbox").parts("label","input","item","itemText","itemIndicator","itemGroup","itemGroupLabel","content","root","valueText"),v=be.build(),E=e=>new O(e);E.empty=()=>new O({items:[]});var ye=e=>new K(e);ye.empty=()=>new K({items:[],columnCount:0});var Ve=e=>e.ids?.root??`select:${e.id}`,R=e=>e.ids?.content??`select:${e.id}:content`,re=e=>e.ids?.label??`select:${e.id}:label`,U=(e,l)=>e.ids?.item?.(l)??`select:${e.id}:option:${l}`,Ee=(e,l)=>e.ids?.itemGroup?.(l)??`select:${e.id}:optgroup:${l}`,ce=(e,l)=>e.ids?.itemGroupLabel?.(l)??`select:${e.id}:optgroup-label:${l}`,C=e=>e.getById(R(e)),ue=(e,l)=>e.getById(U(e,l));function de(e,l){let{context:t,prop:i,scope:a,computed:c,send:o,refs:h}=e,m=i("disabled"),r=i("collection"),A=V(r)?"grid":"list",T=t.get("focused"),_=h.get("focusVisible")&&T,pe=h.get("inputState"),k=t.get("value"),me=t.get("selectedItems"),u=t.get("highlightedValue"),fe=t.get("highlightedItem"),Ie=c("isTypingAhead"),ve=c("isInteractive"),N=u?U(a,u):void 0;function x(n){let s=r.getItemDisabled(n.item),g=r.getItemValue(n.item);ee(g,()=>`[zag-js] No value found for item ${JSON.stringify(n.item)}`);let I=u===g;return{value:g,disabled:!!(m||s),focused:I&&T,focusVisible:I&&_,highlighted:I&&(pe.focused?T:_),selected:t.get("value").includes(g)}}return{empty:k.length===0,highlightedItem:fe,highlightedValue:u,clearHighlightedValue(){o({type:"HIGHLIGHTED_VALUE.SET",value:null})},selectedItems:me,hasSelectedItems:c("hasSelectedItems"),value:k,valueAsString:c("valueAsString"),collection:r,disabled:!!m,selectValue(n){o({type:"ITEM.SELECT",value:n})},setValue(n){o({type:"VALUE.SET",value:n})},selectAll(){if(!c("multiple"))throw new Error("[zag-js] Cannot select all items in a single-select listbox");o({type:"VALUE.SET",value:r.getValues()})},highlightValue(n){o({type:"HIGHLIGHTED_VALUE.SET",value:n})},clearValue(n){o(n?{type:"ITEM.CLEAR",value:n}:{type:"VALUE.CLEAR"})},getItemState:x,getRootProps(){return l.element({...v.root.attrs,dir:i("dir"),id:Ve(a),"data-orientation":i("orientation"),"data-disabled":f(m)})},getInputProps(n={}){return l.input({...v.input.attrs,dir:i("dir"),disabled:m,"data-disabled":f(m),autoComplete:"off",autoCorrect:"off","aria-haspopup":"listbox","aria-controls":R(a),"aria-autocomplete":"list","aria-activedescendant":N,spellCheck:!1,enterKeyHint:"go",onFocus(){queueMicrotask(()=>{o({type:"INPUT.FOCUS",autoHighlight:!!n?.autoHighlight})})},onBlur(){o({type:"CONTENT.BLUR",src:"input"})},onInput(s){n?.autoHighlight&&(s.currentTarget.value.trim()||queueMicrotask(()=>{o({type:"HIGHLIGHTED_VALUE.SET",value:null})}))},onKeyDown(s){if(s.defaultPrevented||z(s))return;let g=W(s),I=()=>{s.preventDefault();let D=a.getWin(),d=new D.KeyboardEvent(g.type,g);C(a)?.dispatchEvent(d)};switch(g.key){case"ArrowLeft":case"ArrowRight":{if(!V(r)||s.ctrlKey)return;I()}case"Home":case"End":{if(u==null&&s.shiftKey)return;I()}case"ArrowDown":case"ArrowUp":{I();break}case"Enter":u!=null&&(s.preventDefault(),o({type:"ITEM.CLICK",value:u}));break}}})},getLabelProps(){return l.element({dir:i("dir"),id:re(a),...v.label.attrs,"data-disabled":f(m)})},getValueTextProps(){return l.element({...v.valueText.attrs,dir:i("dir"),"data-disabled":f(m)})},getItemProps(n){let s=x(n);return l.element({id:U(a,s.value),role:"option",...v.item.attrs,dir:i("dir"),"data-value":s.value,"aria-selected":s.selected,"data-selected":f(s.selected),"data-layout":A,"data-state":s.selected?"checked":"unchecked","data-orientation":i("orientation"),"data-highlighted":f(s.highlighted),"data-disabled":f(s.disabled),"aria-disabled":B(s.disabled),onPointerMove(g){n.highlightOnHover&&(s.disabled||g.pointerType!=="mouse"||s.highlighted||o({type:"ITEM.POINTER_MOVE",value:s.value}))},onMouseDown(g){g.preventDefault(),C(a)?.focus()},onClick(g){g.defaultPrevented||s.disabled||o({type:"ITEM.CLICK",value:s.value,shiftKey:g.shiftKey,anchorValue:u,metaKey:w(g)})}})},getItemTextProps(n){let s=x(n);return l.element({...v.itemText.attrs,"data-state":s.selected?"checked":"unchecked","data-disabled":f(s.disabled),"data-highlighted":f(s.highlighted)})},getItemIndicatorProps(n){let s=x(n);return l.element({...v.itemIndicator.attrs,"aria-hidden":!0,"data-state":s.selected?"checked":"unchecked",hidden:!s.selected})},getItemGroupLabelProps(n){let{htmlFor:s}=n;return l.element({...v.itemGroupLabel.attrs,id:ce(a,s),dir:i("dir"),role:"presentation"})},getItemGroupProps(n){let{id:s}=n;return l.element({...v.itemGroup.attrs,"data-disabled":f(m),"data-orientation":i("orientation"),"data-empty":f(r.size===0),id:Ee(a,s),"aria-labelledby":ce(a,s),role:"group",dir:i("dir")})},getContentProps(){return l.element({dir:i("dir"),id:R(a),role:"listbox",...v.content.attrs,"data-activedescendant":N,"aria-activedescendant":N,"data-orientation":i("orientation"),"aria-multiselectable":c("multiple")?!0:void 0,"aria-labelledby":re(a),tabIndex:0,"data-layout":A,"data-empty":f(r.size===0),style:{"--column-count":V(r)?r.columnCount:1},onFocus(){o({type:"CONTENT.FOCUS"})},onBlur(){o({type:"CONTENT.BLUR"})},onKeyDown(n){if(!ve||!$(n.currentTarget,G(n)))return;let s=n.shiftKey,g={ArrowUp(d){let p=null;V(r)&&u?p=r.getPreviousRowValue(u):u&&(p=r.getPreviousValue(u)),!p&&(i("loopFocus")||!u)&&(p=r.lastValue),p&&(d.preventDefault(),o({type:"NAVIGATE",value:p,shiftKey:s,anchorValue:u}))},ArrowDown(d){let p=null;V(r)&&u?p=r.getNextRowValue(u):u&&(p=r.getNextValue(u)),!p&&(i("loopFocus")||!u)&&(p=r.firstValue),p&&(d.preventDefault(),o({type:"NAVIGATE",value:p,shiftKey:s,anchorValue:u}))},ArrowLeft(){if(!V(r)&&i("orientation")==="vertical")return;let d=u?r.getPreviousValue(u):null;!d&&i("loopFocus")&&(d=r.lastValue),d&&(n.preventDefault(),o({type:"NAVIGATE",value:d,shiftKey:s,anchorValue:u}))},ArrowRight(){if(!V(r)&&i("orientation")==="vertical")return;let d=u?r.getNextValue(u):null;!d&&i("loopFocus")&&(d=r.firstValue),d&&(n.preventDefault(),o({type:"NAVIGATE",value:d,shiftKey:s,anchorValue:u}))},Home(d){d.preventDefault();let p=r.firstValue;o({type:"NAVIGATE",value:p,shiftKey:s,anchorValue:u})},End(d){d.preventDefault();let p=r.lastValue;o({type:"NAVIGATE",value:p,shiftKey:s,anchorValue:u})},Enter(){o({type:"ITEM.CLICK",value:u})},a(d){w(d)&&c("multiple")&&!i("disallowSelectAll")&&(d.preventDefault(),o({type:"VALUE.SET",value:r.getValues()}))},Space(d){Ie&&i("typeahead")?o({type:"CONTENT.TYPEAHEAD",key:d.key}):g.Enter?.(d)},Escape(d){i("deselectable")&&k.length>0&&(d.preventDefault(),d.stopPropagation(),o({type:"VALUE.CLEAR"}))}},I=g[J(n)];if(I){I(n);return}let D=G(n);j(D)||F.isValidEvent(n)&&i("typeahead")&&(o({type:"CONTENT.TYPEAHEAD",key:n.key}),n.preventDefault())}})}}}var{guards:Te,createMachine:Se}=te(),{or:He}=Te,he=Se({props({props:e}){return{loopFocus:!1,composite:!0,defaultValue:[],multiple:!1,typeahead:!0,collection:E.empty(),orientation:"vertical",selectionMode:"single",...e}},context({prop:e,bindable:l}){return{value:l(()=>({defaultValue:e("defaultValue"),value:e("value"),isEqual:Z,onChange(t){let i=e("collection").findMany(t);return e("onValueChange")?.({value:t,items:i})}})),highlightedValue:l(()=>({defaultValue:e("defaultHighlightedValue")||null,value:e("highlightedValue"),sync:!0,onChange(t){e("onHighlightChange")?.({highlightedValue:t,highlightedItem:e("collection").find(t),highlightedIndex:e("collection").indexOf(t)})}})),highlightedItem:l(()=>({defaultValue:null})),selectedItems:l(()=>{let t=e("value")??e("defaultValue")??[];return{defaultValue:e("collection").findMany(t)}}),focused:l(()=>({sync:!0,defaultValue:!1}))}},refs(){return{typeahead:{...F.defaultOptions},focusVisible:!1,inputState:{autoHighlight:!1,focused:!1}}},computed:{hasSelectedItems:({context:e})=>e.get("value").length>0,isTypingAhead:({refs:e})=>e.get("typeahead").keysSoFar!=="",isInteractive:({prop:e})=>!e("disabled"),selection:({context:e,prop:l})=>{let t=new ne(e.get("value"));return t.selectionMode=l("selectionMode"),t.deselectable=!!l("deselectable"),t},multiple:({prop:e})=>e("selectionMode")==="multiple"||e("selectionMode")==="extended",valueAsString:({context:e,prop:l})=>l("collection").stringifyItems(e.get("selectedItems"))},initialState(){return"idle"},watch({context:e,prop:l,track:t,action:i}){t([()=>e.get("value").toString()],()=>{i(["syncSelectedItems"])}),t([()=>e.get("highlightedValue")],()=>{i(["syncHighlightedItem"])}),t([()=>l("collection").toString()],()=>{i(["syncHighlightedValue"])})},effects:["trackFocusVisible"],on:{"HIGHLIGHTED_VALUE.SET":{actions:["setHighlightedItem"]},"ITEM.SELECT":{actions:["selectItem"]},"ITEM.CLEAR":{actions:["clearItem"]},"VALUE.SET":{actions:["setSelectedItems"]},"VALUE.CLEAR":{actions:["clearSelectedItems"]}},states:{idle:{effects:["scrollToHighlightedItem"],on:{"INPUT.FOCUS":{actions:["setFocused","setInputState"]},"CONTENT.FOCUS":[{guard:He("hasSelectedValue","hasHighlightedValue"),actions:["setFocused"]},{actions:["setFocused","setDefaultHighlightedValue"]}],"CONTENT.BLUR":{actions:["clearFocused","clearInputState"]},"ITEM.CLICK":{actions:["setHighlightedItem","selectHighlightedItem"]},"CONTENT.TYPEAHEAD":{actions:["setFocused","highlightMatchingItem"]},"ITEM.POINTER_MOVE":{actions:["highlightItem"]},"ITEM.POINTER_LEAVE":{actions:["clearHighlightedItem"]},NAVIGATE:{actions:["setFocused","setHighlightedItem","selectWithKeyboard"]}}}},implementations:{guards:{hasSelectedValue:({context:e})=>e.get("value").length>0,hasHighlightedValue:({context:e})=>e.get("highlightedValue")!=null},effects:{trackFocusVisible:({scope:e,refs:l})=>se({root:e.getRootNode?.(),onChange(t){l.set("focusVisible",t.isFocusVisible)}}),scrollToHighlightedItem({context:e,prop:l,scope:t}){let i=c=>{let o=e.get("highlightedValue");if(o==null||ae()!=="keyboard")return;let m=C(t),r=l("scrollToIndexFn");if(r){let T=l("collection").indexOf(o);r?.({index:T,immediate:c,getElement(){return ue(t,o)}});return}let A=ue(t,o);X(A,{rootEl:m,block:"nearest"})};return Y(()=>i(!0)),Q(()=>C(t),{defer:!0,attributes:["data-activedescendant"],callback(){i(!1)}})}},actions:{selectHighlightedItem({context:e,prop:l,event:t,computed:i}){let a=t.value??e.get("highlightedValue"),c=l("collection");if(a==null||!c.has(a))return;let o=i("selection");if(t.shiftKey&&i("multiple")&&t.anchorValue){let h=o.extendSelection(c,t.anchorValue,a);L(o,h,l("onSelect")),e.set("value",Array.from(h))}else{let h=o.select(c,a,t.metaKey);L(o,h,l("onSelect")),e.set("value",Array.from(h))}},selectWithKeyboard({context:e,prop:l,event:t,computed:i}){let a=i("selection"),c=l("collection");if(t.shiftKey&&i("multiple")&&t.anchorValue){let o=a.extendSelection(c,t.anchorValue,t.value);L(a,o,l("onSelect")),e.set("value",Array.from(o));return}if(l("selectOnHighlight")){let o=a.replaceSelection(c,t.value);L(a,o,l("onSelect")),e.set("value",Array.from(o))}},highlightItem({context:e,event:l}){e.set("highlightedValue",l.value)},highlightMatchingItem({context:e,prop:l,event:t,refs:i}){let a=l("collection").search(t.key,{state:i.get("typeahead"),currentValue:e.get("highlightedValue")});a!=null&&e.set("highlightedValue",a)},setHighlightedItem({context:e,event:l}){e.set("highlightedValue",l.value)},clearHighlightedItem({context:e}){e.set("highlightedValue",null)},selectItem({context:e,prop:l,event:t,computed:i}){let a=l("collection"),c=i("selection"),o=c.select(a,t.value);L(c,o,l("onSelect")),e.set("value",Array.from(o))},clearItem({context:e,event:l,computed:t}){let a=t("selection").deselect(l.value);e.set("value",Array.from(a))},setSelectedItems({context:e,event:l}){e.set("value",l.value)},clearSelectedItems({context:e}){e.set("value",[])},syncSelectedItems({context:e,prop:l}){let t=l("collection"),i=e.get("selectedItems"),c=e.get("value").map(o=>i.find(m=>t.getItemValue(m)===o)||t.find(o));e.set("selectedItems",c)},syncHighlightedItem({context:e,prop:l}){let t=l("collection"),i=e.get("highlightedValue"),a=i?t.find(i):null;e.set("highlightedItem",a)},syncHighlightedValue({context:e,prop:l,refs:t}){let i=l("collection"),a=e.get("highlightedValue"),{autoHighlight:c}=t.get("inputState");if(c){queueMicrotask(()=>{e.set("highlightedValue",l("collection").firstValue??null)});return}a!=null&&!i.has(a)&&queueMicrotask(()=>{e.set("highlightedValue",null)})},setFocused({context:e}){e.set("focused",!0)},setDefaultHighlightedValue({context:e,prop:l}){let i=l("collection").firstValue;i!=null&&e.set("highlightedValue",i)},clearFocused({context:e}){e.set("focused",!1)},setInputState({refs:e,event:l}){e.set("inputState",{autoHighlight:!!l.autoHighlight,focused:!0})},clearInputState({refs:e}){e.set("inputState",{autoHighlight:!1,focused:!1})}}}}),Le=(e,l)=>{let t=new Set(e);for(let i of l)t.delete(i);return t};function L(e,l,t){let i=Le(l,e);for(let a of i)t?.({value:a})}var Ae=H()(["collection","defaultHighlightedValue","defaultValue","dir","disabled","deselectable","disallowSelectAll","getRootNode","highlightedValue","id","ids","loopFocus","onHighlightChange","onSelect","onValueChange","orientation","scrollToIndexFn","selectionMode","selectOnHighlight","typeahead","value"]),Oe=S(Ae),xe=H()(["item","highlightOnHover"]),Ke=S(xe),Pe=H()(["id"]),Re=S(Pe),Ce=H()(["htmlFor"]),Ue=S(Ce);var M=class extends oe{_options=[];hasGroups=!1;constructor(l,t){super(l,t);let i=t.collection;this._options=i?.items??[]}get options(){return Array.isArray(this._options)?this._options:[]}setOptions(l){this._options=Array.isArray(l)?l:[]}getCollection(){let l=this.options;return this.hasGroups?E({items:l,itemToValue:t=>t.id??t.value??"",itemToString:t=>t.label,isItemDisabled:t=>!!t.disabled,groupBy:t=>t.group??""}):E({items:l,itemToValue:t=>t.id??t.value??"",itemToString:t=>t.label,isItemDisabled:t=>!!t.disabled})}initMachine(l){let t=this.getCollection.bind(this),i=l.collection;return new ie(he,{...l,get collection(){return i??t()}})}initApi(){return de(this.machine.service,le)}init=()=>{this.machine.start(),this.render(),this.machine.subscribe(()=>{this.api=this.initApi(),this.render()})};applyItemProps(){let l=this.el.querySelector('[data-scope="listbox"][data-part="content"]');l&&(l.querySelectorAll('[data-scope="listbox"][data-part="item-group"]').forEach(t=>{let i=t.dataset.id??"";this.spreadProps(t,this.api.getItemGroupProps({id:i}));let a=t.querySelector('[data-scope="listbox"][data-part="item-group-label"]');a&&this.spreadProps(a,this.api.getItemGroupLabelProps({htmlFor:i}))}),l.querySelectorAll('[data-scope="listbox"][data-part="item"]').forEach(t=>{let i=t.dataset.value??"",a=this.options.find(h=>String(h.id??h.value??"")===String(i));if(!a)return;this.spreadProps(t,this.api.getItemProps({item:a}));let c=t.querySelector('[data-scope="listbox"][data-part="item-text"]');c&&this.spreadProps(c,this.api.getItemTextProps({item:a}));let o=t.querySelector('[data-scope="listbox"][data-part="item-indicator"]');o&&this.spreadProps(o,this.api.getItemIndicatorProps({item:a}))}))}render(){let l=this.el.querySelector('[data-scope="listbox"][data-part="root"]')??this.el;this.spreadProps(l,this.api.getRootProps());let t=this.el.querySelector('[data-scope="listbox"][data-part="label"]');t&&this.spreadProps(t,this.api.getLabelProps());let i=this.el.querySelector('[data-scope="listbox"][data-part="value-text"]');i&&this.spreadProps(i,this.api.getValueTextProps());let a=this.el.querySelector('[data-scope="listbox"][data-part="input"]');a&&this.spreadProps(a,this.api.getInputProps());let c=this.el.querySelector('[data-scope="listbox"][data-part="content"]');c&&(this.spreadProps(c,this.api.getContentProps()),this.applyItemProps())}};function ge(e,l){return l?E({items:e,itemToValue:t=>t.id??t.value??"",itemToString:t=>t.label,isItemDisabled:t=>!!t.disabled,groupBy:t=>t.group??""}):E({items:e,itemToValue:t=>t.id??t.value??"",itemToString:t=>t.label,isItemDisabled:t=>!!t.disabled})}var Ye={mounted(){let e=this.el,l=JSON.parse(e.dataset.collection??"[]"),t=l.some(h=>h.group!==void 0),i=P(e,"value"),a=P(e,"defaultValue"),c=b(e,"controlled"),o=new M(e,{id:e.id,collection:ge(l,t),...c&&i?{value:i}:{defaultValue:a??[]},disabled:b(e,"disabled"),dir:y(e,"dir",["ltr","rtl"]),orientation:y(e,"orientation",["horizontal","vertical"]),loopFocus:b(e,"loopFocus"),selectionMode:y(e,"selectionMode",["single","multiple","extended"]),selectOnHighlight:b(e,"selectOnHighlight"),deselectable:b(e,"deselectable"),typeahead:b(e,"typeahead"),onValueChange:h=>{let m=y(e,"onValueChange");m&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(m,{value:h.value,items:h.items,id:e.id});let r=y(e,"onValueChangeClient");r&&e.dispatchEvent(new CustomEvent(r,{bubbles:!0,detail:{value:h,id:e.id}}))}});o.hasGroups=t,o.setOptions(l),o.init(),this.listbox=o,this.handlers=[]},updated(){let e=JSON.parse(this.el.dataset.collection??"[]"),l=e.some(a=>a.group!==void 0),t=P(this.el,"value"),i=b(this.el,"controlled");this.listbox&&(this.listbox.hasGroups=l,this.listbox.setOptions(e),this.listbox.updateProps({collection:ge(e,l),id:this.el.id,...i&&t?{value:t}:{},disabled:b(this.el,"disabled"),dir:y(this.el,"dir",["ltr","rtl"]),orientation:y(this.el,"orientation",["horizontal","vertical"])}))},destroyed(){if(this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.listbox?.destroy()}};export{Ye as Listbox};
