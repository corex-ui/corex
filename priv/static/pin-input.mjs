import{A as O,Bb as Z,Cb as X,Db as J,E as M,Fb as f,Gb as x,Hb as S,Ib as r,K as D,L as w,M as q,Oa as j,S as _,a as H,ba as V,d,e as k,f as R,hb as A,nb as K,oa as $,rb as G,xb as z,ya as B,yb as W}from"./chunk-IYURAQ6S.mjs";var oe=H("pinInput").parts("root","label","input","control"),C=oe.build(),E=e=>e.ids?.root??`pin-input:${e.id}`,le=(e,t)=>e.ids?.input?.(t)??`pin-input:${e.id}:${t}`,N=e=>e.ids?.hiddenInput??`pin-input:${e.id}:hidden`,se=e=>e.ids?.label??`pin-input:${e.id}:label`,re=e=>e.ids?.control??`pin-input:${e.id}:control`,de=e=>e.getById(E(e)),T=e=>{let n=`input[data-ownedby=${CSS.escape(E(e))}]`;return $(de(e),n)},y=(e,t)=>T(e)[t],pe=e=>T(e)[0],Q=e=>e.getById(N(e)),F=(e,t)=>{e.value=t,e.setAttribute("value",t)},ce={numeric:/^[0-9]+$/,alphabetic:/^[A-Za-z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/i};function fe(e,t){return e?!!ce[e]?.test(t):!0}function Y(e,t,n){return n?new RegExp(n,"g").test(e):fe(t,e)}function te(e,t){let{send:n,context:i,computed:l,prop:a,scope:u}=e,v=l("isValueComplete"),c=!!a("disabled"),g=!!a("readOnly"),m=!!a("invalid"),P=!!a("required"),ae=a("translations"),ie=i.get("focusedIndex");function U(){pe(u)?.focus()}return{focus:U,count:i.get("count"),items:Array.from({length:i.get("count")}).map((h,p)=>p),value:i.get("value"),valueAsString:l("valueAsString"),complete:v,setValue(h){Array.isArray(h)||G("[pin-input/setValue] value must be an array"),n({type:"VALUE.SET",value:h})},clearValue(){n({type:"VALUE.CLEAR"})},setValueAtIndex(h,p){n({type:"VALUE.SET",value:p,index:h})},getRootProps(){return t.element({dir:a("dir"),...C.root.attrs,id:E(u),"data-invalid":d(m),"data-disabled":d(c),"data-complete":d(v),"data-readonly":d(g)})},getLabelProps(){return t.label({...C.label.attrs,dir:a("dir"),htmlFor:N(u),id:se(u),"data-invalid":d(m),"data-disabled":d(c),"data-complete":d(v),"data-required":d(P),"data-readonly":d(g),onClick(h){h.preventDefault(),U()}})},getHiddenInputProps(){return t.input({"aria-hidden":!0,type:"text",tabIndex:-1,id:N(u),readOnly:g,disabled:c,required:P,name:a("name"),form:a("form"),style:B,maxLength:l("valueLength"),defaultValue:l("valueAsString")})},getControlProps(){return t.element({...C.control.attrs,dir:a("dir"),id:re(u)})},getInputProps(h){let{index:p}=h,ue=a("type")==="numeric"?"tel":"text";return t.input({...C.input.attrs,dir:a("dir"),disabled:c,"data-disabled":d(c),"data-complete":d(v),id:le(u,p.toString()),"data-index":p,"data-ownedby":E(u),"aria-label":ae?.inputLabel?.(p,l("valueLength")),inputMode:a("otp")||a("type")==="numeric"?"numeric":"text","aria-invalid":k(m),"data-invalid":d(m),type:a("mask")?"password":ue,defaultValue:i.get("value")[p]||"",readOnly:g,autoCapitalize:"none",autoComplete:a("otp")?"one-time-code":"off",placeholder:ie===p?"":a("placeholder"),onPaste(o){let s=o.clipboardData?.getData("text/plain");if(!s)return;if(!Y(s,a("type"),a("pattern"))){n({type:"VALUE.INVALID",value:s}),o.preventDefault();return}o.preventDefault(),n({type:"INPUT.PASTE",value:s})},onBeforeInput(o){try{let s=O(o);Y(s,a("type"),a("pattern"))||(n({type:"VALUE.INVALID",value:s}),o.preventDefault()),s.length>1&&o.currentTarget.setSelectionRange(0,1,"forward")}catch{}},onChange(o){let s=q(o),{value:I}=o.currentTarget;if(s.inputType==="insertFromPaste"){o.currentTarget.value=I[0]||"";return}if(I.length>2){n({type:"INPUT.PASTE",value:I}),o.currentTarget.value=I[0],o.preventDefault();return}if(s.inputType==="deleteContentBackward"){n({type:"INPUT.BACKSPACE"});return}n({type:"INPUT.CHANGE",value:I,index:p})},onKeyDown(o){if(o.defaultPrevented||M(o)||D(o))return;let I={Backspace(){n({type:"INPUT.BACKSPACE"})},Delete(){n({type:"INPUT.DELETE"})},ArrowLeft(){n({type:"INPUT.ARROW_LEFT"})},ArrowRight(){n({type:"INPUT.ARROW_RIGHT"})},Enter(){n({type:"INPUT.ENTER"})}}[w(o,{dir:a("dir"),orientation:"horizontal"})];I&&(I(o),o.preventDefault())},onFocus(){n({type:"INPUT.FOCUS",index:p})},onBlur(o){let s=o.relatedTarget;R(s)&&s.dataset.ownedby===E(u)||n({type:"INPUT.BLUR",index:p})}})}}}var{choose:Ie,createMachine:ve}=z(),ne=ve({props({props:e}){return{placeholder:"\u25CB",otp:!1,type:"numeric",defaultValue:e.count?b([],e.count):[],...e,translations:{inputLabel:(t,n)=>`pin code ${t+1} of ${n}`,...e.translations}}},initialState(){return"idle"},context({prop:e,bindable:t}){return{value:t(()=>({value:e("value"),defaultValue:e("defaultValue"),isEqual:j,onChange(n){e("onValueChange")?.({value:n,valueAsString:n.join("")})}})),focusedIndex:t(()=>({sync:!0,defaultValue:-1})),count:t(()=>({defaultValue:e("count")}))}},computed:{_value:({context:e})=>b(e.get("value"),e.get("count")),valueLength:({computed:e})=>e("_value").length,filledValueLength:({computed:e})=>e("_value").filter(t=>t?.trim()!=="").length,isValueComplete:({computed:e})=>e("valueLength")===e("filledValueLength"),valueAsString:({computed:e})=>e("_value").join(""),focusedValue:({computed:e,context:t})=>e("_value")[t.get("focusedIndex")]||""},entry:Ie([{guard:"autoFocus",actions:["setInputCount","setFocusIndexToFirst"]},{actions:["setInputCount"]}]),watch({action:e,track:t,context:n,computed:i}){t([()=>n.get("focusedIndex")],()=>{e(["focusInput","selectInputIfNeeded"])}),t([()=>n.get("value").join(",")],()=>{e(["syncInputElements","dispatchInputEvent"])}),t([()=>i("isValueComplete")],()=>{e(["invokeOnComplete","blurFocusedInputIfNeeded"])})},on:{"VALUE.SET":[{guard:"hasIndex",actions:["setValueAtIndex"]},{actions:["setValue"]}],"VALUE.CLEAR":{actions:["clearValue","setFocusIndexToFirst"]}},states:{idle:{on:{"INPUT.FOCUS":{target:"focused",actions:["setFocusedIndex"]}}},focused:{on:{"INPUT.CHANGE":{actions:["setFocusedValue","syncInputValue","setNextFocusedIndex"]},"INPUT.PASTE":{actions:["setPastedValue","setLastValueFocusIndex"]},"INPUT.FOCUS":{actions:["setFocusedIndex"]},"INPUT.BLUR":{target:"idle",actions:["clearFocusedIndex"]},"INPUT.DELETE":{guard:"hasValue",actions:["clearFocusedValue"]},"INPUT.ARROW_LEFT":{actions:["setPrevFocusedIndex"]},"INPUT.ARROW_RIGHT":{actions:["setNextFocusedIndex"]},"INPUT.BACKSPACE":[{guard:"hasValue",actions:["clearFocusedValue"]},{actions:["setPrevFocusedIndex","clearFocusedValue"]}],"INPUT.ENTER":{guard:"isValueComplete",actions:["requestFormSubmit"]},"VALUE.INVALID":{actions:["invokeOnInvalid"]}}}},implementations:{guards:{autoFocus:({prop:e})=>!!e("autoFocus"),hasValue:({context:e})=>e.get("value")[e.get("focusedIndex")]!=="",isValueComplete:({computed:e})=>e("isValueComplete"),hasIndex:({event:e})=>e.index!==void 0},actions:{dispatchInputEvent({computed:e,scope:t}){let n=Q(t);_(n,{value:e("valueAsString")})},setInputCount({scope:e,context:t,prop:n}){if(n("count"))return;let i=T(e);t.set("count",i.length)},focusInput({context:e,scope:t}){let n=e.get("focusedIndex");n!==-1&&y(t,n)?.focus({preventScroll:!0})},selectInputIfNeeded({context:e,prop:t,scope:n}){let i=e.get("focusedIndex");!t("selectOnFocus")||i===-1||V(()=>{y(n,i)?.select()})},invokeOnComplete({computed:e,prop:t}){e("isValueComplete")&&t("onValueComplete")?.({value:e("_value"),valueAsString:e("valueAsString")})},invokeOnInvalid({context:e,event:t,prop:n}){n("onValueInvalid")?.({value:t.value,index:e.get("focusedIndex")})},clearFocusedIndex({context:e}){e.set("focusedIndex",-1)},setFocusedIndex({context:e,event:t}){e.set("focusedIndex",t.index)},setValue({context:e,event:t}){let n=b(t.value,e.get("count"));e.set("value",n)},setFocusedValue({context:e,event:t,computed:n,flush:i}){let l=n("focusedValue"),a=e.get("focusedIndex"),u=ee(l,t.value);i(()=>{e.set("value",A(n("_value"),a,u))})},revertInputValue({context:e,computed:t,scope:n}){let i=y(n,e.get("focusedIndex"));F(i,t("focusedValue"))},syncInputValue({context:e,event:t,scope:n}){let i=e.get("value"),l=y(n,t.index);F(l,i[t.index])},syncInputElements({context:e,scope:t}){let n=T(t),i=e.get("value");n.forEach((l,a)=>{F(l,i[a])})},setPastedValue({context:e,event:t,computed:n,flush:i}){V(()=>{let l=n("valueAsString"),a=e.get("focusedIndex"),u=n("valueLength"),v=n("filledValueLength"),c=Math.min(a,v),g=c>0?l.substring(0,a):"",m=t.value.substring(0,u-c),P=b(`${g}${m}`.split(""),u);i(()=>{e.set("value",P)})})},setValueAtIndex({context:e,event:t,computed:n}){let i=ee(n("focusedValue"),t.value);e.set("value",A(n("_value"),t.index,i))},clearValue({context:e}){let t=Array.from({length:e.get("count")}).fill("");queueMicrotask(()=>{e.set("value",t)})},clearFocusedValue({context:e,computed:t}){let n=e.get("focusedIndex");n!==-1&&e.set("value",A(t("_value"),n,""))},setFocusIndexToFirst({context:e}){e.set("focusedIndex",0)},setNextFocusedIndex({context:e,computed:t}){e.set("focusedIndex",Math.min(e.get("focusedIndex")+1,t("valueLength")-1))},setPrevFocusedIndex({context:e}){e.set("focusedIndex",Math.max(e.get("focusedIndex")-1,0))},setLastValueFocusIndex({context:e,computed:t}){V(()=>{e.set("focusedIndex",Math.min(t("filledValueLength"),t("valueLength")-1))})},blurFocusedInputIfNeeded({context:e,prop:t,scope:n}){t("blurOnComplete")&&V(()=>{y(n,e.get("focusedIndex"))?.blur()})},requestFormSubmit({computed:e,prop:t,scope:n}){if(!t("name")||!e("isValueComplete"))return;Q(n)?.form?.requestSubmit()}}}});function ee(e,t){let n=t;e[0]===t[0]?n=t[1]:e[0]===t[1]&&(n=t[0]);let i=n.split("");return n=i[i.length-1],n??""}function b(e,t){return Array.from({length:t}).fill("").map((n,i)=>e[i]||n)}var he=W()(["autoFocus","blurOnComplete","count","defaultValue","dir","disabled","form","getRootNode","id","ids","invalid","mask","name","onValueChange","onValueComplete","onValueInvalid","otp","pattern","placeholder","readOnly","required","selectOnFocus","translations","type","value"]),Pe=K(he);var L=class extends J{initMachine(t){return new X(ne,t)}initApi(){return te(this.machine.service,Z)}render(){let t=this.el.querySelector('[data-scope="pin-input"][data-part="root"]')??this.el;this.spreadProps(t,this.api.getRootProps());let n=this.el.querySelector('[data-scope="pin-input"][data-part="label"]');n&&this.spreadProps(n,this.api.getLabelProps());let i=this.el.querySelector('[data-scope="pin-input"][data-part="hidden-input"]');i&&this.spreadProps(i,this.api.getHiddenInputProps());let l=this.el.querySelector('[data-scope="pin-input"][data-part="control"]');l&&this.spreadProps(l,this.api.getControlProps()),this.api.items.forEach(a=>{let u=this.el.querySelector(`[data-scope="pin-input"][data-part="input"][data-index="${a}"]`);u&&this.spreadProps(u,this.api.getInputProps({index:a}))})}};var Fe={mounted(){let e=this.el,t=x(e,"value"),n=x(e,"defaultValue"),i=r(e,"controlled"),l=new L(e,{id:e.id,count:S(e,"count")??4,...i&&t?{value:t}:{defaultValue:n??[]},disabled:r(e,"disabled"),invalid:r(e,"invalid"),required:r(e,"required"),readOnly:r(e,"readOnly"),mask:r(e,"mask"),otp:r(e,"otp"),blurOnComplete:r(e,"blurOnComplete"),selectOnFocus:r(e,"selectOnFocus"),name:f(e,"name"),form:f(e,"form"),dir:f(e,"dir",["ltr","rtl"]),type:f(e,"type",["alphanumeric","numeric","alphabetic"]),placeholder:f(e,"placeholder"),onValueChange:a=>{let u=e.querySelector('[data-scope="pin-input"][data-part="hidden-input"]');u&&(u.value=a.valueAsString,u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0})));let v=f(e,"onValueChange");v&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(v,{value:a.value,valueAsString:a.valueAsString,id:e.id});let c=f(e,"onValueChangeClient");c&&e.dispatchEvent(new CustomEvent(c,{bubbles:!0,detail:{value:a,id:e.id}}))},onValueComplete:a=>{let u=f(e,"onValueComplete");u&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(u,{value:a.value,valueAsString:a.valueAsString,id:e.id})}});l.init(),this.pinInput=l,this.handlers=[]},updated(){let e=x(this.el,"value"),t=r(this.el,"controlled");this.pinInput?.updateProps({id:this.el.id,count:S(this.el,"count")??this.pinInput?.api.count??4,...t&&e?{value:e}:{},disabled:r(this.el,"disabled"),invalid:r(this.el,"invalid"),required:r(this.el,"required"),readOnly:r(this.el,"readOnly"),name:f(this.el,"name"),form:f(this.el,"form")})},destroyed(){if(this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.pinInput?.destroy()}};export{Fe as PinInput};
