import{a as K}from"./chunk-MMRG4CGO.mjs";import{b as x,c as Ie}from"./chunk-S6MRQC6S.mjs";import{a as ve}from"./chunk-5MNNWH4C.mjs";import"./chunk-L4HS2GN2.mjs";import{$ as se,B as W,Bb as he,Cb as pe,Db as me,Fb as I,Gb as H,Ha as $,Ib as p,L as j,Oa as de,U as ne,_ as oe,a as ee,ba as F,d as u,da as ae,e as te,ha as re,j as ie,k as le,nb as V,sb as ue,wb as ge,xa as N,ya as ce,yb as L}from"./chunk-IYURAQ6S.mjs";var Le=ee("select").parts("label","positioner","trigger","indicator","clearTrigger","item","itemText","itemIndicator","itemGroup","itemGroupLabel","list","content","root","control","valueText"),m=Le.build(),y=e=>new K(e);y.empty=()=>new K({items:[]});var He=e=>e.ids?.root??`select:${e.id}`,J=e=>e.ids?.content??`select:${e.id}:content`,Q=e=>e.ids?.trigger??`select:${e.id}:trigger`,ye=e=>e.ids?.clearTrigger??`select:${e.id}:clear-trigger`,D=e=>e.ids?.label??`select:${e.id}:label`,Ge=e=>e.ids?.control??`select:${e.id}:control`,X=(e,t)=>e.ids?.item?.(t)??`select:${e.id}:option:${t}`,Z=e=>e.ids?.hiddenSelect??`select:${e.id}:select`,Oe=e=>e.ids?.positioner??`select:${e.id}:positioner`,ke=(e,t)=>e.ids?.itemGroup?.(t)??`select:${e.id}:optgroup:${t}`,fe=(e,t)=>e.ids?.itemGroupLabel?.(t)??`select:${e.id}:optgroup-label:${t}`,B=e=>e.getById(Z(e)),G=e=>e.getById(J(e)),C=e=>e.getById(Q(e)),Ae=e=>e.getById(ye(e)),Ee=e=>e.getById(Oe(e)),Y=(e,t)=>t==null?null:e.getById(X(e,t));function Se(e,t){let{context:i,prop:l,scope:n,state:a,computed:d,send:s}=e,c=l("disabled")||i.get("fieldsetDisabled"),g=!!l("invalid"),E=!!l("required"),O=!!l("readOnly"),S=l("composite"),f=l("collection"),v=a.hasTag("open"),R=a.matches("focused"),T=i.get("highlightedValue"),Re=i.get("highlightedItem"),Pe=i.get("selectedItems"),w=i.get("currentPlacement"),z=d("isTypingAhead"),_=d("isInteractive"),q=T?X(n,T):void 0;function A(o){let r=f.getItemDisabled(o.item),h=f.getItemValue(o.item);return ue(h,()=>`[zag-js] No value found for item ${JSON.stringify(o.item)}`),{value:h,disabled:!!(c||r),highlighted:T===h,selected:i.get("value").includes(h)}}let Ve=Ie({...l("positioning"),placement:w});return{open:v,focused:R,empty:i.get("value").length===0,highlightedItem:Re,highlightedValue:T,selectedItems:Pe,hasSelectedItems:d("hasSelectedItems"),value:i.get("value"),valueAsString:d("valueAsString"),collection:f,multiple:!!l("multiple"),disabled:!!c,reposition(o={}){s({type:"POSITIONING.SET",options:o})},focus(){C(n)?.focus({preventScroll:!0})},setOpen(o){a.hasTag("open")!==o&&s({type:o?"OPEN":"CLOSE"})},selectValue(o){s({type:"ITEM.SELECT",value:o})},setValue(o){s({type:"VALUE.SET",value:o})},selectAll(){s({type:"VALUE.SET",value:f.getValues()})},setHighlightValue(o){s({type:"HIGHLIGHTED_VALUE.SET",value:o})},clearHighlightValue(){s({type:"HIGHLIGHTED_VALUE.CLEAR"})},clearValue(o){s(o?{type:"ITEM.CLEAR",value:o}:{type:"VALUE.CLEAR"})},getItemState:A,getRootProps(){return t.element({...m.root.attrs,dir:l("dir"),id:He(n),"data-invalid":u(g),"data-readonly":u(O)})},getLabelProps(){return t.label({dir:l("dir"),id:D(n),...m.label.attrs,"data-disabled":u(c),"data-invalid":u(g),"data-readonly":u(O),"data-required":u(E),htmlFor:Z(n),onClick(o){o.defaultPrevented||c||C(n)?.focus({preventScroll:!0})}})},getControlProps(){return t.element({...m.control.attrs,dir:l("dir"),id:Ge(n),"data-state":v?"open":"closed","data-focus":u(R),"data-disabled":u(c),"data-invalid":u(g)})},getValueTextProps(){return t.element({...m.valueText.attrs,dir:l("dir"),"data-disabled":u(c),"data-invalid":u(g),"data-focus":u(R)})},getTriggerProps(){return t.button({id:Q(n),disabled:c,dir:l("dir"),type:"button",role:"combobox","aria-controls":J(n),"aria-expanded":v,"aria-haspopup":"listbox","data-state":v?"open":"closed","aria-invalid":g,"aria-required":E,"aria-labelledby":D(n),...m.trigger.attrs,"data-disabled":u(c),"data-invalid":u(g),"data-readonly":u(O),"data-placement":w,"data-placeholder-shown":u(!d("hasSelectedItems")),onClick(o){_&&(o.defaultPrevented||s({type:"TRIGGER.CLICK"}))},onFocus(){s({type:"TRIGGER.FOCUS"})},onBlur(){s({type:"TRIGGER.BLUR"})},onKeyDown(o){if(o.defaultPrevented||!_)return;let h={ArrowUp(){s({type:"TRIGGER.ARROW_UP"})},ArrowDown(P){s({type:P.altKey?"OPEN":"TRIGGER.ARROW_DOWN"})},ArrowLeft(){s({type:"TRIGGER.ARROW_LEFT"})},ArrowRight(){s({type:"TRIGGER.ARROW_RIGHT"})},Home(){s({type:"TRIGGER.HOME"})},End(){s({type:"TRIGGER.END"})},Enter(){s({type:"TRIGGER.ENTER"})},Space(P){s(z?{type:"TRIGGER.TYPEAHEAD",key:P.key}:{type:"TRIGGER.ENTER"})}}[j(o,{dir:l("dir"),orientation:"vertical"})];if(h){h(o),o.preventDefault();return}N.isValidEvent(o)&&(s({type:"TRIGGER.TYPEAHEAD",key:o.key}),o.preventDefault())}})},getIndicatorProps(){return t.element({...m.indicator.attrs,dir:l("dir"),"aria-hidden":!0,"data-state":v?"open":"closed","data-disabled":u(c),"data-invalid":u(g),"data-readonly":u(O)})},getItemProps(o){let r=A(o);return t.element({id:X(n,r.value),role:"option",...m.item.attrs,dir:l("dir"),"data-value":r.value,"aria-selected":r.selected,"data-state":r.selected?"checked":"unchecked","data-highlighted":u(r.highlighted),"data-disabled":u(r.disabled),"aria-disabled":te(r.disabled),onPointerMove(h){r.disabled||h.pointerType!=="mouse"||r.value!==T&&s({type:"ITEM.POINTER_MOVE",value:r.value})},onClick(h){h.defaultPrevented||r.disabled||s({type:"ITEM.CLICK",src:"pointerup",value:r.value})},onPointerLeave(h){r.disabled||o.persistFocus||h.pointerType!=="mouse"||!e.event.previous()?.type.includes("POINTER")||s({type:"ITEM.POINTER_LEAVE"})}})},getItemTextProps(o){let r=A(o);return t.element({...m.itemText.attrs,"data-state":r.selected?"checked":"unchecked","data-disabled":u(r.disabled),"data-highlighted":u(r.highlighted)})},getItemIndicatorProps(o){let r=A(o);return t.element({"aria-hidden":!0,...m.itemIndicator.attrs,"data-state":r.selected?"checked":"unchecked",hidden:!r.selected})},getItemGroupLabelProps(o){let{htmlFor:r}=o;return t.element({...m.itemGroupLabel.attrs,id:fe(n,r),dir:l("dir"),role:"presentation"})},getItemGroupProps(o){let{id:r}=o;return t.element({...m.itemGroup.attrs,"data-disabled":u(c),id:ke(n,r),"aria-labelledby":fe(n,r),role:"group",dir:l("dir")})},getClearTriggerProps(){return t.button({...m.clearTrigger.attrs,id:ye(n),type:"button","aria-label":"Clear value","data-invalid":u(g),disabled:c,hidden:!d("hasSelectedItems"),dir:l("dir"),onClick(o){o.defaultPrevented||s({type:"CLEAR.CLICK"})}})},getHiddenSelectProps(){let o=i.get("value"),r=l("multiple")?o:o?.[0];return t.select({name:l("name"),form:l("form"),disabled:c,multiple:l("multiple"),required:l("required"),"aria-hidden":!0,id:Z(n),defaultValue:r,style:ce,tabIndex:-1,onFocus(){C(n)?.focus({preventScroll:!0})},"aria-labelledby":D(n)})},getPositionerProps(){return t.element({...m.positioner.attrs,dir:l("dir"),id:Oe(n),style:Ve.floating})},getContentProps(){return t.element({hidden:!v,dir:l("dir"),id:J(n),role:S?"listbox":"dialog",...m.content.attrs,"data-state":v?"open":"closed","data-placement":w,"data-activedescendant":q,"aria-activedescendant":S?q:void 0,"aria-multiselectable":l("multiple")&&S?!0:void 0,"aria-labelledby":D(n),tabIndex:0,onKeyDown(o){if(!_||!le(o.currentTarget,W(o)))return;if(o.key==="Tab"&&!se(o)){o.preventDefault();return}let r={ArrowUp(){s({type:"CONTENT.ARROW_UP"})},ArrowDown(){s({type:"CONTENT.ARROW_DOWN"})},Home(){s({type:"CONTENT.HOME"})},End(){s({type:"CONTENT.END"})},Enter(){s({type:"ITEM.CLICK",src:"keydown.enter"})},Space(U){z?s({type:"CONTENT.TYPEAHEAD",key:U.key}):r.Enter?.(U)}},h=r[j(o)];if(h){h(o),o.preventDefault();return}let P=W(o);ie(P)||N.isValidEvent(o)&&(s({type:"CONTENT.TYPEAHEAD",key:o.key}),o.preventDefault())}})},getListProps(){return t.element({...m.list.attrs,tabIndex:0,role:S?void 0:"listbox","aria-labelledby":Q(n),"aria-activedescendant":S?void 0:q,"aria-multiselectable":!S&&l("multiple")?!0:void 0})}}}var{and:k,not:b,or:Fe}=ge(),be={props({props:e}){return{loopFocus:!1,closeOnSelect:!e.multiple,composite:!0,defaultValue:[],...e,collection:e.collection??y.empty(),positioning:{placement:"bottom-start",gutter:8,...e.positioning}}},context({prop:e,bindable:t}){return{value:t(()=>({defaultValue:e("defaultValue"),value:e("value"),isEqual:de,onChange(i){let l=e("collection").findMany(i);return e("onValueChange")?.({value:i,items:l})}})),highlightedValue:t(()=>({defaultValue:e("defaultHighlightedValue")||null,value:e("highlightedValue"),onChange(i){e("onHighlightChange")?.({highlightedValue:i,highlightedItem:e("collection").find(i),highlightedIndex:e("collection").indexOf(i)})}})),currentPlacement:t(()=>({defaultValue:void 0})),fieldsetDisabled:t(()=>({defaultValue:!1})),highlightedItem:t(()=>({defaultValue:null})),selectedItems:t(()=>{let i=e("value")??e("defaultValue")??[];return{defaultValue:e("collection").findMany(i)}})}},refs(){return{typeahead:{...N.defaultOptions}}},computed:{hasSelectedItems:({context:e})=>e.get("value").length>0,isTypingAhead:({refs:e})=>e.get("typeahead").keysSoFar!=="",isDisabled:({prop:e,context:t})=>!!e("disabled")||!!t.get("fieldsetDisabled"),isInteractive:({prop:e})=>!(e("disabled")||e("readOnly")),valueAsString:({context:e,prop:t})=>t("collection").stringifyItems(e.get("selectedItems"))},initialState({prop:e}){return e("open")||e("defaultOpen")?"open":"idle"},entry:["syncSelectElement"],watch({context:e,prop:t,track:i,action:l}){i([()=>e.get("value").toString()],()=>{l(["syncSelectedItems","syncSelectElement","dispatchChangeEvent"])}),i([()=>t("open")],()=>{l(["toggleVisibility"])}),i([()=>e.get("highlightedValue")],()=>{l(["syncHighlightedItem"])}),i([()=>t("collection").toString()],()=>{l(["syncCollection"])})},on:{"HIGHLIGHTED_VALUE.SET":{actions:["setHighlightedItem"]},"HIGHLIGHTED_VALUE.CLEAR":{actions:["clearHighlightedItem"]},"ITEM.SELECT":{actions:["selectItem"]},"ITEM.CLEAR":{actions:["clearItem"]},"VALUE.SET":{actions:["setSelectedItems"]},"VALUE.CLEAR":{actions:["clearSelectedItems"]},"CLEAR.CLICK":{actions:["clearSelectedItems","focusTriggerEl"]}},effects:["trackFormControlState"],states:{idle:{tags:["closed"],on:{"CONTROLLED.OPEN":[{guard:"isTriggerClickEvent",target:"open",actions:["setInitialFocus","highlightFirstSelectedItem"]},{target:"open",actions:["setInitialFocus"]}],"TRIGGER.CLICK":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["invokeOnOpen","setInitialFocus","highlightFirstSelectedItem"]}],"TRIGGER.FOCUS":{target:"focused"},OPEN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen"]}]}},focused:{tags:["closed"],on:{"CONTROLLED.OPEN":[{guard:"isTriggerClickEvent",target:"open",actions:["setInitialFocus","highlightFirstSelectedItem"]},{guard:"isTriggerArrowUpEvent",target:"open",actions:["setInitialFocus","highlightComputedLastItem"]},{guard:Fe("isTriggerArrowDownEvent","isTriggerEnterEvent"),target:"open",actions:["setInitialFocus","highlightComputedFirstItem"]},{target:"open",actions:["setInitialFocus"]}],OPEN:[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen"]}],"TRIGGER.BLUR":{target:"idle"},"TRIGGER.CLICK":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen","highlightFirstSelectedItem"]}],"TRIGGER.ENTER":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen","highlightComputedFirstItem"]}],"TRIGGER.ARROW_UP":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen","highlightComputedLastItem"]}],"TRIGGER.ARROW_DOWN":[{guard:"isOpenControlled",actions:["invokeOnOpen"]},{target:"open",actions:["setInitialFocus","invokeOnOpen","highlightComputedFirstItem"]}],"TRIGGER.ARROW_LEFT":[{guard:k(b("multiple"),"hasSelectedItems"),actions:["selectPreviousItem"]},{guard:b("multiple"),actions:["selectLastItem"]}],"TRIGGER.ARROW_RIGHT":[{guard:k(b("multiple"),"hasSelectedItems"),actions:["selectNextItem"]},{guard:b("multiple"),actions:["selectFirstItem"]}],"TRIGGER.HOME":{guard:b("multiple"),actions:["selectFirstItem"]},"TRIGGER.END":{guard:b("multiple"),actions:["selectLastItem"]},"TRIGGER.TYPEAHEAD":{guard:b("multiple"),actions:["selectMatchingItem"]}}},open:{tags:["open"],exit:["scrollContentToTop"],effects:["trackDismissableElement","computePlacement","scrollToHighlightedItem"],on:{"CONTROLLED.CLOSE":[{guard:"restoreFocus",target:"focused",actions:["focusTriggerEl","clearHighlightedItem"]},{target:"idle",actions:["clearHighlightedItem"]}],CLOSE:[{guard:"isOpenControlled",actions:["invokeOnClose"]},{guard:"restoreFocus",target:"focused",actions:["invokeOnClose","focusTriggerEl","clearHighlightedItem"]},{target:"idle",actions:["invokeOnClose","clearHighlightedItem"]}],"TRIGGER.CLICK":[{guard:"isOpenControlled",actions:["invokeOnClose"]},{target:"focused",actions:["invokeOnClose","clearHighlightedItem"]}],"ITEM.CLICK":[{guard:k("closeOnSelect","isOpenControlled"),actions:["selectHighlightedItem","invokeOnClose"]},{guard:"closeOnSelect",target:"focused",actions:["selectHighlightedItem","invokeOnClose","focusTriggerEl","clearHighlightedItem"]},{actions:["selectHighlightedItem"]}],"CONTENT.HOME":{actions:["highlightFirstItem"]},"CONTENT.END":{actions:["highlightLastItem"]},"CONTENT.ARROW_DOWN":[{guard:k("hasHighlightedItem","loop","isLastItemHighlighted"),actions:["highlightFirstItem"]},{guard:"hasHighlightedItem",actions:["highlightNextItem"]},{actions:["highlightFirstItem"]}],"CONTENT.ARROW_UP":[{guard:k("hasHighlightedItem","loop","isFirstItemHighlighted"),actions:["highlightLastItem"]},{guard:"hasHighlightedItem",actions:["highlightPreviousItem"]},{actions:["highlightLastItem"]}],"CONTENT.TYPEAHEAD":{actions:["highlightMatchingItem"]},"ITEM.POINTER_MOVE":{actions:["highlightItem"]},"ITEM.POINTER_LEAVE":{actions:["clearHighlightedItem"]},"POSITIONING.SET":{actions:["reposition"]}}}},implementations:{guards:{loop:({prop:e})=>!!e("loopFocus"),multiple:({prop:e})=>!!e("multiple"),hasSelectedItems:({computed:e})=>!!e("hasSelectedItems"),hasHighlightedItem:({context:e})=>e.get("highlightedValue")!=null,isFirstItemHighlighted:({context:e,prop:t})=>e.get("highlightedValue")===t("collection").firstValue,isLastItemHighlighted:({context:e,prop:t})=>e.get("highlightedValue")===t("collection").lastValue,closeOnSelect:({prop:e,event:t})=>!!(t.closeOnSelect??e("closeOnSelect")),restoreFocus:({event:e})=>Te(e),isOpenControlled:({prop:e})=>e("open")!==void 0,isTriggerClickEvent:({event:e})=>e.previousEvent?.type==="TRIGGER.CLICK",isTriggerEnterEvent:({event:e})=>e.previousEvent?.type==="TRIGGER.ENTER",isTriggerArrowUpEvent:({event:e})=>e.previousEvent?.type==="TRIGGER.ARROW_UP",isTriggerArrowDownEvent:({event:e})=>e.previousEvent?.type==="TRIGGER.ARROW_DOWN"},effects:{trackFormControlState({context:e,scope:t}){return ne(B(t),{onFieldsetDisabledChange(i){e.set("fieldsetDisabled",i)},onFormReset(){let i=e.initial("value");e.set("value",i)}})},trackDismissableElement({scope:e,send:t,prop:i}){let l=()=>G(e),n=!0;return ve(l,{type:"listbox",defer:!0,exclude:[C(e),Ae(e)],onFocusOutside:i("onFocusOutside"),onPointerDownOutside:i("onPointerDownOutside"),onInteractOutside(a){i("onInteractOutside")?.(a),n=!(a.detail.focusable||a.detail.contextmenu)},onDismiss(){t({type:"CLOSE",src:"interact-outside",restoreFocus:n})}})},computePlacement({context:e,prop:t,scope:i}){let l=t("positioning");return e.set("currentPlacement",l.placement),x(()=>C(i),()=>Ee(i),{defer:!0,...l,onComplete(d){e.set("currentPlacement",d.placement)}})},scrollToHighlightedItem({context:e,prop:t,scope:i,event:l}){let n=d=>{let s=e.get("highlightedValue");if(s==null||l.current().type.includes("POINTER"))return;let c=G(i),g=t("scrollToIndexFn");if(g){let O=t("collection").indexOf(s);g?.({index:O,immediate:d,getElement:()=>Y(i,s)});return}let E=Y(i,s);re(E,{rootEl:c,block:"nearest"})};return F(()=>n(!0)),ae(()=>G(i),{defer:!0,attributes:["data-activedescendant"],callback(){n(!1)}})}},actions:{reposition({context:e,prop:t,scope:i,event:l}){let n=()=>Ee(i);x(C(i),n,{...t("positioning"),...l.options,defer:!0,listeners:!1,onComplete(a){e.set("currentPlacement",a.placement)}})},toggleVisibility({send:e,prop:t,event:i}){e({type:t("open")?"CONTROLLED.OPEN":"CONTROLLED.CLOSE",previousEvent:i})},highlightPreviousItem({context:e,prop:t}){let i=e.get("highlightedValue");if(i==null)return;let l=t("collection").getPreviousValue(i,1,t("loopFocus"));l!=null&&e.set("highlightedValue",l)},highlightNextItem({context:e,prop:t}){let i=e.get("highlightedValue");if(i==null)return;let l=t("collection").getNextValue(i,1,t("loopFocus"));l!=null&&e.set("highlightedValue",l)},highlightFirstItem({context:e,prop:t}){let i=t("collection").firstValue;e.set("highlightedValue",i)},highlightLastItem({context:e,prop:t}){let i=t("collection").lastValue;e.set("highlightedValue",i)},setInitialFocus({scope:e}){F(()=>{oe({root:G(e)})?.focus({preventScroll:!0})})},focusTriggerEl({event:e,scope:t}){Te(e)&&F(()=>{C(t)?.focus({preventScroll:!0})})},selectHighlightedItem({context:e,prop:t,event:i}){let l=i.value??e.get("highlightedValue");if(l==null||!t("collection").has(l))return;t("onSelect")?.({value:l}),l=t("deselectable")&&!t("multiple")&&e.get("value").includes(l)?null:l,e.set("value",a=>l==null?[]:t("multiple")?$(a,l):[l])},highlightComputedFirstItem({context:e,prop:t,computed:i}){let l=t("collection"),n=i("hasSelectedItems")?l.sort(e.get("value"))[0]:l.firstValue;e.set("highlightedValue",n)},highlightComputedLastItem({context:e,prop:t,computed:i}){let l=t("collection"),n=i("hasSelectedItems")?l.sort(e.get("value"))[0]:l.lastValue;e.set("highlightedValue",n)},highlightFirstSelectedItem({context:e,prop:t,computed:i}){if(!i("hasSelectedItems"))return;let l=t("collection").sort(e.get("value"))[0];e.set("highlightedValue",l)},highlightItem({context:e,event:t}){e.set("highlightedValue",t.value)},highlightMatchingItem({context:e,prop:t,event:i,refs:l}){let n=t("collection").search(i.key,{state:l.get("typeahead"),currentValue:e.get("highlightedValue")});n!=null&&e.set("highlightedValue",n)},setHighlightedItem({context:e,event:t}){e.set("highlightedValue",t.value)},clearHighlightedItem({context:e}){e.set("highlightedValue",null)},selectItem({context:e,prop:t,event:i}){t("onSelect")?.({value:i.value});let n=t("deselectable")&&!t("multiple")&&e.get("value").includes(i.value)?null:i.value;e.set("value",a=>n==null?[]:t("multiple")?$(a,n):[n])},clearItem({context:e,event:t}){e.set("value",i=>i.filter(l=>l!==t.value))},setSelectedItems({context:e,event:t}){e.set("value",t.value)},clearSelectedItems({context:e}){e.set("value",[])},selectPreviousItem({context:e,prop:t}){let[i]=e.get("value"),l=t("collection").getPreviousValue(i);l&&e.set("value",[l])},selectNextItem({context:e,prop:t}){let[i]=e.get("value"),l=t("collection").getNextValue(i);l&&e.set("value",[l])},selectFirstItem({context:e,prop:t}){let i=t("collection").firstValue;i&&e.set("value",[i])},selectLastItem({context:e,prop:t}){let i=t("collection").lastValue;i&&e.set("value",[i])},selectMatchingItem({context:e,prop:t,event:i,refs:l}){let n=t("collection").search(i.key,{state:l.get("typeahead"),currentValue:e.get("value")[0]});n!=null&&e.set("value",[n])},scrollContentToTop({prop:e,scope:t}){if(e("scrollToIndexFn")){let i=e("collection").firstValue;e("scrollToIndexFn")?.({index:0,immediate:!0,getElement:()=>Y(t,i)})}else G(t)?.scrollTo(0,0)},invokeOnOpen({prop:e,context:t}){e("onOpenChange")?.({open:!0,value:t.get("value")})},invokeOnClose({prop:e,context:t}){e("onOpenChange")?.({open:!1,value:t.get("value")})},syncSelectElement({context:e,prop:t,scope:i}){let l=B(i);if(l){if(e.get("value").length===0&&!t("multiple")){l.selectedIndex=-1;return}for(let n of l.options)n.selected=e.get("value").includes(n.value)}},syncCollection({context:e,prop:t}){let i=t("collection"),l=i.find(e.get("highlightedValue"));l&&e.set("highlightedItem",l);let n=i.findMany(e.get("value"));e.set("selectedItems",n)},syncSelectedItems({context:e,prop:t}){let i=t("collection"),l=e.get("selectedItems"),a=e.get("value").map(d=>l.find(c=>i.getItemValue(c)===d)||i.find(d));e.set("selectedItems",a)},syncHighlightedItem({context:e,prop:t}){let i=t("collection"),l=e.get("highlightedValue"),n=l?i.find(l):null;e.set("highlightedItem",n)},dispatchChangeEvent({scope:e}){queueMicrotask(()=>{let t=B(e);if(!t)return;let i=e.getWin(),l=new i.Event("change",{bubbles:!0,composed:!0});t.dispatchEvent(l)})}}}};function Te(e){let t=e.restoreFocus??e.previousEvent?.restoreFocus;return t==null||!!t}var Ne=L()(["closeOnSelect","collection","composite","defaultHighlightedValue","defaultOpen","defaultValue","deselectable","dir","disabled","form","getRootNode","highlightedValue","id","ids","invalid","loopFocus","multiple","name","onFocusOutside","onHighlightChange","onInteractOutside","onOpenChange","onPointerDownOutside","onSelect","onValueChange","open","positioning","readOnly","required","scrollToIndexFn","value"]),Qe=V(Ne),De=L()(["item","persistFocus"]),Xe=V(De),Me=L()(["id"]),Ze=V(Me),we=L()(["htmlFor"]),ze=V(we);var M=class extends me{_options=[];hasGroups=!1;placeholder="";constructor(t,i){super(t,i);let l=i.collection;this._options=l?.items??[],this.placeholder=I(this.el,"placeholder")||""}get options(){return Array.isArray(this._options)?this._options:[]}setOptions(t){this._options=Array.isArray(t)?t:[]}getCollection(){let t=this.options;return this.hasGroups?y({items:t,itemToValue:i=>i.id??i.value??"",itemToString:i=>i.label,isItemDisabled:i=>!!i.disabled,groupBy:i=>i.group??""}):y({items:t,itemToValue:i=>i.id??i.value??"",itemToString:i=>i.label,isItemDisabled:i=>!!i.disabled})}initMachine(t){let i=this.getCollection.bind(this),l=t.collection;return new pe(be,{...t,get collection(){return l??i()}})}initApi(){return Se(this.machine.service,he)}init=()=>{this.machine.start(),this.render(),this.machine.subscribe(()=>{this.api=this.initApi(),this.render()})};applyItemProps(){let t=this.el.querySelector('[data-scope="select"][data-part="content"]');t&&(t.querySelectorAll('[data-scope="select"][data-part="item-group"]').forEach(i=>{let l=i.dataset.id??"";this.spreadProps(i,this.api.getItemGroupProps({id:l}));let n=i.querySelector('[data-scope="select"][data-part="item-group-label"]');n&&this.spreadProps(n,this.api.getItemGroupLabelProps({htmlFor:l}))}),t.querySelectorAll('[data-scope="select"][data-part="item"]').forEach(i=>{let l=i.dataset.value??"",n=this.options.find(s=>String(s.id??s.value??"")===String(l));if(!n)return;this.spreadProps(i,this.api.getItemProps({item:n}));let a=i.querySelector('[data-scope="select"][data-part="item-text"]');a&&this.spreadProps(a,this.api.getItemTextProps({item:n}));let d=i.querySelector('[data-scope="select"][data-part="item-indicator"]');d&&this.spreadProps(d,this.api.getItemIndicatorProps({item:n}))}))}render(){let t=this.el.querySelector('[data-scope="select"][data-part="root"]')??this.el;this.spreadProps(t,this.api.getRootProps());let i=this.el.querySelector('[data-scope="select"][data-part="hidden-select"]'),l=this.el.querySelector('[data-scope="select"][data-part="value-input"]');l&&(!this.api.value||this.api.value.length===0?l.value="":this.api.value.length===1?l.value=String(this.api.value[0]):l.value=this.api.value.map(String).join(",")),i&&this.spreadProps(i,this.api.getHiddenSelectProps()),["label","control","trigger","indicator","clear-trigger","positioner"].forEach(d=>{let s=this.el.querySelector(`[data-scope="select"][data-part="${d}"]`);if(!s)return;let c="get"+d.split("-").map(g=>g[0].toUpperCase()+g.slice(1)).join("")+"Props";this.spreadProps(s,this.api[c]())});let n=this.el.querySelector('[data-scope="select"][data-part="item-text"]');if(n){let d=this.api.valueAsString;if(this.api.value&&this.api.value.length>0&&!d){let s=this.api.value[0],c=this.options.find(g=>{let E=g.id??g.value??"";return String(E)===String(s)});c?n.textContent=c.label:n.textContent=this.placeholder||""}else n.textContent=d||this.placeholder||""}let a=this.el.querySelector('[data-scope="select"][data-part="content"]');a&&(this.spreadProps(a,this.api.getContentProps()),this.applyItemProps())}};function Ce(e,t){return t?y({items:e,itemToValue:i=>i.id??i.value??"",itemToString:i=>i.label,isItemDisabled:i=>!!i.disabled,groupBy:i=>i.group??""}):y({items:e,itemToValue:i=>i.id??i.value??"",itemToString:i=>i.label,isItemDisabled:i=>!!i.disabled})}function _e(e){return e.replace(/_([a-z])/g,(t,i)=>i.toUpperCase())}function qe(e){let t={};for(let[i,l]of Object.entries(e)){let n=_e(i);t[n]=l}return t}var ct={mounted(){let e=this.el,t=JSON.parse(e.dataset.collection||"[]"),i=t.some(a=>a.group!==void 0),l=Ce(t,i),n=new M(e,{id:e.id,collection:l,...p(e,"controlled")?{value:H(e,"value")}:{defaultValue:H(e,"defaultValue")},disabled:p(e,"disabled"),closeOnSelect:p(e,"closeOnSelect"),dir:I(e,"dir",["ltr","rtl"]),loopFocus:p(e,"loopFocus"),multiple:p(e,"multiple"),invalid:p(e,"invalid"),name:I(e,"name"),form:I(e,"form"),readOnly:p(e,"readOnly"),required:p(e,"required"),positioning:(()=>{let a=e.dataset.positioning;if(a)try{let d=JSON.parse(a);return qe(d)}catch{return}})(),onValueChange:a=>{let d=p(e,"redirect"),s=a.value.length>0?String(a.value[0]):null,c=a.items?.length?a.items[0]:null,g=c&&typeof c=="object"&&c!==null&&"redirect"in c?c.redirect:void 0,E=c&&typeof c=="object"&&c!==null&&"new_tab"in c?c.new_tab:void 0;d&&s&&this.liveSocket.main.isDead&&g!==!1&&(E===!0?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s);let f=e.querySelector('[data-scope="select"][data-part="value-input"]');f&&(f.value=a.value.length===0?"":a.value.length===1?String(a.value[0]):a.value.map(String).join(","),f.dispatchEvent(new Event("input",{bubbles:!0})),f.dispatchEvent(new Event("change",{bubbles:!0})));let v={value:a.value,items:a.items,id:e.id},R=I(e,"onValueChangeClient");R&&e.dispatchEvent(new CustomEvent(R,{bubbles:!0,detail:v}));let T=I(e,"onValueChange");T&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(T,v)}});n.hasGroups=i,n.setOptions(t),n.init(),this.select=n,this.handlers=[]},updated(){let e=JSON.parse(this.el.dataset.collection||"[]"),t=e.some(i=>i.group!==void 0);this.select&&(this.select.hasGroups=t,this.select.setOptions(e),this.select.updateProps({collection:Ce(e,t),id:this.el.id,...p(this.el,"controlled")?{value:H(this.el,"value")}:{defaultValue:H(this.el,"defaultValue")},name:I(this.el,"name"),form:I(this.el,"form"),disabled:p(this.el,"disabled"),multiple:p(this.el,"multiple"),dir:I(this.el,"dir",["ltr","rtl"]),invalid:p(this.el,"invalid"),required:p(this.el,"required"),readOnly:p(this.el,"readOnly")}))},destroyed(){if(this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.select?.destroy()}};export{ct as Select};
