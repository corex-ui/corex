import{B as ct,Bb as St,Cb as yt,Db as wt,Fb as O,Hb as _,I as gt,Ib as j,K as ft,a as dt,d as D,ia as nt,ma as mt,nb as vt,pa as Pt,u as ht,yb as Et}from"./chunk-IYURAQ6S.mjs";var{PI:Kt}=Math,x=Kt+1e-4,bt=.5,Mt=[1,1];function It(t,e,n,r=a=>a){return t*r(.5-e*(.5-n))}var{min:rt}=Math;function qt(t,e,n){let r=rt(1,e/n);return rt(1,t+(rt(1,1-r)-t)*(r*.275))}function Qt(t){return[-t[0],-t[1]]}function v(t,e){return[t[0]+e[0],t[1]+e[1]]}function kt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function M(t,e){return[t[0]-e[0],t[1]-e[1]]}function st(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function b(t,e){return[t[0]*e,t[1]*e]}function at(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Xt(t,e){return[t[0]/e,t[1]/e]}function Nt(t){return[t[1],-t[0]]}function it(t,e){let n=e[0];return t[0]=e[1],t[1]=-n,t}function Tt(t,e){return t[0]*e[0]+t[1]*e[1]}function Yt(t,e){return t[0]===e[0]&&t[1]===e[1]}function Zt(t){return Math.hypot(t[0],t[1])}function Lt(t,e){let n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function At(t){return Xt(t,Zt(t))}function te(t,e){return Math.hypot(t[1]-e[1],t[0]-e[0])}function ot(t,e,n){let r=Math.sin(n),a=Math.cos(n),i=t[0]-e[0],o=t[1]-e[1],s=i*a-o*r,l=i*r+o*a;return[s+e[0],l+e[1]]}function Ht(t,e,n,r){let a=Math.sin(r),i=Math.cos(r),o=e[0]-n[0],s=e[1]-n[1],l=o*i-s*a,p=o*a+s*i;return t[0]=l+n[0],t[1]=p+n[1],t}function Ct(t,e,n){return v(t,b(M(e,t),n))}function ee(t,e,n,r){let a=n[0]-e[0],i=n[1]-e[1];return t[0]=e[0]+a*r,t[1]=e[1]+i*r,t}function _t(t,e,n){return v(t,b(e,n))}var c=[0,0],y=[0,0],w=[0,0];function ne(t,e){let n=_t(t,At(Nt(M(t,v(t,[1,1])))),-e),r=[],a=1/13;for(let i=a;i<=1;i+=a)r.push(ot(n,t,x*2*i));return r}function re(t,e,n){let r=[],a=1/n;for(let i=a;i<=1;i+=a)r.push(ot(e,t,x*i));return r}function ae(t,e,n){let r=M(e,n),a=b(r,.5),i=b(r,.51);return[M(t,a),M(t,i),v(t,i),v(t,a)]}function ie(t,e,n,r){let a=[],i=_t(t,e,n),o=1/r;for(let s=o;s<1;s+=o)a.push(ot(i,t,x*3*s));return a}function se(t,e,n){return[v(t,b(e,n)),v(t,b(e,n*.99)),M(t,b(e,n*.99)),M(t,b(e,n))]}function Dt(t,e,n){return t===!1||t===void 0?0:t===!0?Math.max(e,n):t}function oe(t,e,n){return t.slice(0,10).reduce((r,a)=>{let i=a.pressure;return e&&(i=qt(r,a.distance,n)),(r+i)/2},t[0].pressure)}function ue(t,e={}){let{size:n=16,smoothing:r=.5,thinning:a=.5,simulatePressure:i=!0,easing:o=d=>d,start:s={},end:l={},last:p=!1}=e,{cap:f=!0,easing:g=d=>d*(2-d)}=s,{cap:h=!0,easing:m=d=>--d*d*d+1}=l;if(t.length===0||n<=0)return[];let u=t[t.length-1].runningLength,E=Dt(s.taper,n,u),I=Dt(l.taper,n,u),R=(n*r)**2,k=[],C=[],ut=oe(t,i,n),P=It(n,a,t[t.length-1].pressure,o),z,K=t[0].vector,q=t[0].point,U=q,T=q,L=U,Q=!1;for(let d=0;d<t.length;d++){let{pressure:tt}=t[d],{point:S,vector:N,distance:Bt,runningLength:A}=t[d],F=d===t.length-1;if(!F&&u-A<3)continue;a?(i&&(tt=qt(ut,Bt,n)),P=It(n,a,tt,o)):P=n/2,z===void 0&&(z=P);let Jt=A<E?g(A/E):1,Wt=u-A<I?m((u-A)/I):1;P=Math.max(.01,P*Math.min(Jt,Wt));let lt=(F?t[d]:t[d+1]).vector,et=F?1:Tt(N,lt),zt=Tt(N,K)<0&&!Q,pt=et!==null&&et<0;if(zt||pt){it(c,K),at(c,c,P);for(let $=0;$<=1;$+=.07692307692307693)st(y,S,c),Ht(y,y,S,x*$),T=[y[0],y[1]],k.push(T),kt(w,S,c),Ht(w,w,S,x*-$),L=[w[0],w[1]],C.push(L);q=T,U=L,pt&&(Q=!0);continue}if(Q=!1,F){it(c,N),at(c,c,P),k.push(M(S,c)),C.push(v(S,c));continue}ee(c,lt,N,et),it(c,c),at(c,c,P),st(y,S,c),T=[y[0],y[1]],(d<=1||Lt(q,T)>R)&&(k.push(T),q=T),kt(w,S,c),L=[w[0],w[1]],(d<=1||Lt(U,L)>R)&&(C.push(L),U=L),ut=tt,K=N}let X=[t[0].point[0],t[0].point[1]],Y=t.length>1?[t[t.length-1].point[0],t[t.length-1].point[1]]:v(t[0].point,[1,1]),Z=[],V=[];if(t.length===1){if(!(E||I)||p)return ne(X,z||P)}else{E||I&&t.length===1||(f?Z.push(...re(X,C[0],13)):Z.push(...ae(X,k[0],C[0])));let d=Nt(Qt(t[t.length-1].vector));I||E&&t.length===1?V.push(Y):h?V.push(...ie(Y,d,P,29)):V.push(...se(Y,d,P))}return k.concat(V,C.reverse(),Z)}var Ot=[0,0];function Rt(t){return t!=null&&t>=0}function le(t,e={}){let{streamline:n=.5,size:r=16,last:a=!1}=e;if(t.length===0)return[];let i=.15+(1-n)*.85,o=Array.isArray(t[0])?t:t.map(({x:h,y:m,pressure:u=bt})=>[h,m,u]);if(o.length===2){let h=o[1];o=o.slice(0,-1);for(let m=1;m<5;m++)o.push(Ct(o[0],h,m/4))}o.length===1&&(o=[...o,[...v(o[0],Mt),...o[0].slice(2)]]);let s=[{point:[o[0][0],o[0][1]],pressure:Rt(o[0][2])?o[0][2]:.25,vector:[...Mt],distance:0,runningLength:0}],l=!1,p=0,f=s[0],g=o.length-1;for(let h=1;h<o.length;h++){let m=a&&h===g?[o[h][0],o[h][1]]:Ct(f.point,o[h],i);if(Yt(f.point,m))continue;let u=te(m,f.point);if(p+=u,h<g&&!l){if(p<r)continue;l=!0}st(Ot,f.point,m),f={point:m,pressure:Rt(o[h][2])?o[h][2]:bt,vector:At(Ot),distance:u,runningLength:p},s.push(f)}return s[0].vector=s[1]?.vector||[0,0],s}function pe(t,e={}){return ue(le(t,e),e)}var xt=pe;var de=dt("signature-pad").parts("root","control","segment","segmentPath","guide","clearTrigger","label"),H=de.build(),he=t=>t.ids?.root??`signature-${t.id}`,Vt=t=>t.ids?.control??`signature-control-${t.id}`,ce=t=>t.ids?.label??`signature-label-${t.id}`,Ut=t=>t.ids?.hiddenInput??`signature-input-${t.id}`,B=t=>t.getById(Vt(t)),ge=t=>Pt(B(t),"[data-part=segment]"),Ft=(t,e)=>ht(ge(t),e);function $t(t,e){let{state:n,send:r,prop:a,computed:i,context:o,scope:s}=t,l=n.matches("drawing"),p=i("isEmpty"),f=i("isInteractive"),g=!!a("disabled"),h=!!a("required"),m=a("translations");return{empty:p,drawing:l,currentPath:o.get("currentPath"),paths:o.get("paths"),clear(){r({type:"CLEAR"})},getDataUrl(u,E){return i("isEmpty")?Promise.resolve(""):Ft(s,{type:u,quality:E})},getLabelProps(){return e.label({...H.label.attrs,id:ce(s),"data-disabled":D(g),"data-required":D(h),htmlFor:Ut(s),onClick(u){if(!f||u.defaultPrevented)return;B(s)?.focus({preventScroll:!0})}})},getRootProps(){return e.element({...H.root.attrs,"data-disabled":D(g),id:he(s)})},getControlProps(){return e.element({...H.control.attrs,tabIndex:g?void 0:0,id:Vt(s),role:"application","aria-roledescription":"signature pad","aria-label":m.control,"aria-disabled":g,"data-disabled":D(g),onPointerDown(u){if(!gt(u)||ft(u)||!f||ct(u)?.closest("[data-part=clear-trigger]"))return;u.currentTarget.setPointerCapture(u.pointerId);let I={x:u.clientX,y:u.clientY},R=B(s);if(!R)return;let{offset:k}=nt(I,R);r({type:"POINTER_DOWN",point:k,pressure:u.pressure})},onPointerUp(u){f&&u.currentTarget.hasPointerCapture(u.pointerId)&&u.currentTarget.releasePointerCapture(u.pointerId)},style:{position:"relative",touchAction:"none",userSelect:"none",WebkitUserSelect:"none"}})},getSegmentProps(){return e.svg({...H.segment.attrs,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",fill:a("drawing").fill}})},getSegmentPathProps(u){return e.path({...H.segmentPath.attrs,d:u.path})},getGuideProps(){return e.element({...H.guide.attrs,"data-disabled":D(g)})},getClearTriggerProps(){return e.button({...H.clearTrigger.attrs,type:"button","aria-label":m.clearTrigger,hidden:!o.get("paths").length||l,disabled:g,onClick(){r({type:"CLEAR"})}})},getHiddenInputProps(u){return e.input({id:Ut(s),type:"text",hidden:!0,disabled:g,required:a("required"),readOnly:!0,name:a("name"),value:u.value})}}}var G=(t,e)=>(t+e)/2;function fe(t,e=!0){let n=t.length;if(n<4)return"";let r=t[0],a=t[1],i=t[2],o=`M${r[0].toFixed(2)},${r[1].toFixed(2)} Q${a[0].toFixed(2)},${a[1].toFixed(2)} ${G(a[0],i[0]).toFixed(2)},${G(a[1],i[1]).toFixed(2)} T`;for(let s=2,l=n-1;s<l;s++)r=t[s],a=t[s+1],o+=`${G(r[0],a[0]).toFixed(2)},${G(r[1],a[1]).toFixed(2)} `;return e&&(o+="Z"),o}var jt={props({props:t}){return{defaultPaths:[],...t,drawing:{size:2,simulatePressure:!1,thinning:.7,smoothing:.4,streamline:.6,...t.drawing},translations:{control:"signature pad",clearTrigger:"clear signature",...t.translations}}},initialState(){return"idle"},context({prop:t,bindable:e}){return{paths:e(()=>({defaultValue:t("defaultPaths"),value:t("paths"),sync:!0,onChange(n){t("onDraw")?.({paths:n})}})),currentPoints:e(()=>({defaultValue:[]})),currentPath:e(()=>({defaultValue:null}))}},computed:{isInteractive:({prop:t})=>!(t("disabled")||t("readOnly")),isEmpty:({context:t})=>t.get("paths").length===0},on:{CLEAR:{actions:["clearPoints","invokeOnDrawEnd","focusCanvasEl"]}},states:{idle:{on:{POINTER_DOWN:{target:"drawing",actions:["addPoint"]}}},drawing:{effects:["trackPointerMove"],on:{POINTER_MOVE:{actions:["addPoint","invokeOnDraw"]},POINTER_UP:{target:"idle",actions:["endStroke","invokeOnDrawEnd"]}}}},implementations:{effects:{trackPointerMove({scope:t,send:e}){let n=t.getDoc();return mt(n,{onPointerMove({event:r,point:a}){let i=B(t);if(!i)return;let{offset:o}=nt(a,i);e({type:"POINTER_MOVE",point:o,pressure:r.pressure})},onPointerUp(){e({type:"POINTER_UP"})}})}},actions:{addPoint({context:t,event:e,prop:n}){let r=[...t.get("currentPoints"),e.point];t.set("currentPoints",r);let a=xt(r,n("drawing"));t.set("currentPath",fe(a))},endStroke({context:t}){let e=[...t.get("paths"),t.get("currentPath")];t.set("paths",e),t.set("currentPoints",[]),t.set("currentPath",null)},clearPoints({context:t}){t.set("currentPoints",[]),t.set("paths",[]),t.set("currentPath",null)},focusCanvasEl({scope:t}){queueMicrotask(()=>{t.getActiveElement()?.focus({preventScroll:!0})})},invokeOnDraw({context:t,prop:e}){e("onDraw")?.({paths:[...t.get("paths"),t.get("currentPath")]})},invokeOnDrawEnd({context:t,prop:e,scope:n,computed:r}){e("onDrawEnd")?.({paths:[...t.get("paths")],getDataUrl(a,i=.92){return r("isEmpty")?Promise.resolve(""):Ft(n,{type:a,quality:i})}})}}}},me=Et()(["defaultPaths","dir","disabled","drawing","getRootNode","id","ids","name","onDraw","onDrawEnd","paths","readOnly","required","translations"]),be=vt(me);var J=class extends wt{imageURL="";paths=[];name;initMachine(e){return this.name=e.name,new yt(jt,e)}setName(e){this.name=e}setPaths(e){this.paths=e}initApi(){return $t(this.machine.service,St)}syncPaths=()=>{let e=this.el.querySelector('[data-scope="signature-pad"][data-part="segment"]');if(!e)return;if(this.api.paths.length+(this.api.currentPath?1:0)===0){e.innerHTML="",this.imageURL="",this.paths=[];let r=this.el.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');r&&(r.value="");return}if(e.innerHTML="",this.api.paths.forEach(r=>{let a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("data-scope","signature-pad"),a.setAttribute("data-part","path"),this.spreadProps(a,this.api.getSegmentPathProps({path:r})),e.appendChild(a)}),this.api.currentPath){let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("data-scope","signature-pad"),r.setAttribute("data-part","current-path"),this.spreadProps(r,this.api.getSegmentPathProps({path:this.api.currentPath})),e.appendChild(r)}};render(){let e=this.el.querySelector('[data-scope="signature-pad"][data-part="root"]');if(!e)return;this.spreadProps(e,this.api.getRootProps());let n=e.querySelector('[data-scope="signature-pad"][data-part="label"]');n&&this.spreadProps(n,this.api.getLabelProps());let r=e.querySelector('[data-scope="signature-pad"][data-part="control"]');r&&this.spreadProps(r,this.api.getControlProps());let a=e.querySelector('[data-scope="signature-pad"][data-part="segment"]');a&&this.spreadProps(a,this.api.getSegmentProps());let i=e.querySelector('[data-scope="signature-pad"][data-part="guide"]');i&&this.spreadProps(i,this.api.getGuideProps());let o=e.querySelector('[data-scope="signature-pad"][data-part="clear-trigger"]');if(o){this.spreadProps(o,this.api.getClearTriggerProps());let l=this.api.paths.length>0||!!this.api.currentPath;o.hidden=!l}let s=e.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');if(s){let l=this.paths.length>0?this.paths:this.api.paths;this.paths.length===0&&this.api.paths.length>0&&(this.paths=[...this.api.paths]);let p=l.length>0?JSON.stringify(l):"";this.spreadProps(s,this.api.getHiddenInputProps({value:p})),this.name&&(s.name=this.name),s.value=p}this.syncPaths()}};function W(t,e){let n=t.dataset[e];if(!n)return[];try{return JSON.parse(n)}catch{return[]}}function Gt(t){return{fill:O(t,"drawingFill")||"black",size:_(t,"drawingSize")??2,simulatePressure:j(t,"drawingSimulatePressure"),smoothing:_(t,"drawingSmoothing")??.5,thinning:_(t,"drawingThinning")??.7,streamline:_(t,"drawingStreamline")??.65}}var De={mounted(){let t=this.el,e=this.pushEvent.bind(this),n=j(t,"controlled"),r=W(t,"paths"),a=W(t,"defaultPaths"),i=new J(t,{id:t.id,name:O(t,"name"),...n&&r.length>0?{paths:r}:void 0,...!n&&a.length>0?{defaultPaths:a}:void 0,drawing:Gt(t),onDrawEnd:s=>{i.setPaths(s.paths);let l=t.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');l&&(l.value=JSON.stringify(s.paths)),s.getDataUrl("image/png").then(p=>{i.imageURL=p;let f=O(t,"onDrawEnd");f&&this.liveSocket.main.isConnected()&&e(f,{id:t.id,paths:s.paths,url:p});let g=O(t,"onDrawEndClient");g&&t.dispatchEvent(new CustomEvent(g,{bubbles:!0,detail:{id:t.id,paths:s.paths,url:p}}))})}});if(i.init(),this.signaturePad=i,(n?r:a).length>0){let s=t.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');s&&(s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})))}this.onClear=s=>{let{id:l}=s.detail;if(l&&l!==t.id)return;i.api.clear(),i.imageURL="",i.setPaths([]);let p=t.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');p&&(p.value="")},t.addEventListener("phx:signature-pad:clear",this.onClear),this.handlers=[],this.handlers.push(this.handleEvent("signature_pad_clear",s=>{let l=s.signature_pad_id;if(l&&l!==t.id)return;i.api.clear(),i.imageURL="",i.setPaths([]);let p=t.querySelector('[data-scope="signature-pad"][data-part="hidden-input"]');p&&(p.value="")}))},updated(){let t=j(this.el,"controlled"),e=W(this.el,"paths"),n=W(this.el,"defaultPaths"),r=O(this.el,"name");r&&this.signaturePad?.setName(r),this.signaturePad?.updateProps({id:this.el.id,name:r,...t&&e.length>0?{paths:e}:{},...!t&&n.length>0?{defaultPaths:n}:{},drawing:Gt(this.el)})},destroyed(){if(this.onClear&&this.el.removeEventListener("phx:signature-pad:clear",this.onClear),this.handlers)for(let t of this.handlers)this.removeHandleEvent(t);this.signaturePad?.destroy()}};export{De as SignaturePad};
