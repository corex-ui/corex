import{Bb as I,Cb as H,Db as R,Fb as M,Hb as d,Ib as p,_a as y,a as v,eb as E,nb as P,ob as S,pb as w,vb as k,yb as b}from"./chunk-IYURAQ6S.mjs";var j=v("timer").parts("root","area","control","item","itemValue","itemLabel","actionTrigger","separator"),m=j.build(),N=e=>e.ids?.root??`timer:${e.id}:root`,x=e=>e.ids?.area??`timer:${e.id}:area`,A=new Set(["start","pause","resume","reset","restart"]);function C(e,t){let{state:r,send:a,computed:s,scope:c}=e,i=r.matches("running"),o=r.matches("paused"),l=s("time"),u=s("formattedTime"),g=s("progressPercent");return{running:i,paused:o,time:l,formattedTime:u,progressPercent:g,start(){a({type:"START"})},pause(){a({type:"PAUSE"})},resume(){a({type:"RESUME"})},reset(){a({type:"RESET"})},restart(){a({type:"RESTART"})},getRootProps(){return t.element({id:N(c),...m.root.attrs})},getAreaProps(){return t.element({role:"timer",id:x(c),"aria-label":`${l.days} days ${u.hours}:${u.minutes}:${u.seconds}`,"aria-atomic":!0,...m.area.attrs})},getControlProps(){return t.element({...m.control.attrs})},getItemProps(n){let T=l[n.type];return t.element({...m.item.attrs,"data-type":n.type,style:{"--value":T}})},getItemLabelProps(n){return t.element({...m.itemLabel.attrs,"data-type":n.type})},getItemValueProps(n){return t.element({...m.itemValue.attrs,"data-type":n.type})},getSeparatorProps(){return t.element({"aria-hidden":!0,...m.separator.attrs})},getActionTriggerProps(n){if(!A.has(n.action))throw new Error(`[zag-js] Invalid action: ${n.action}. Must be one of: ${Array.from(A).join(", ")}`);return t.button({...m.actionTrigger.attrs,hidden:y(n.action,{start:()=>i||o,pause:()=>!i,reset:()=>!i&&!o,resume:()=>!o,restart:()=>!1}),type:"button",onClick(T){T.defaultPrevented||a({type:n.action.toUpperCase()})}})}}}var L={props({props:e}){return U(e),{interval:1e3,startMs:0,...e}},initialState({prop:e}){return e("autoStart")?"running":"idle"},context({prop:e,bindable:t}){return{currentMs:t(()=>({defaultValue:e("startMs")}))}},watch({track:e,send:t,prop:r}){e([()=>r("startMs")],()=>{t({type:"RESTART"})})},on:{RESTART:{target:"running:temp",actions:["resetTime"]}},computed:{time:({context:e})=>q(e.get("currentMs")),formattedTime:({computed:e})=>V(e("time")),progressPercent:k(({context:e,prop:t})=>[e.get("currentMs"),t("targetMs"),t("startMs"),t("countdown")],([e,t=0,r,a])=>{let s=a?$(e,t,r):$(e,r,t);return E(s,0,1)})},states:{idle:{on:{START:{target:"running"},RESET:{actions:["resetTime"]}}},"running:temp":{effects:["waitForNextTick"],on:{CONTINUE:{target:"running"}}},running:{effects:["keepTicking"],on:{PAUSE:{target:"paused"},TICK:[{target:"idle",guard:"hasReachedTarget",actions:["invokeOnComplete"]},{actions:["updateTime","invokeOnTick"]}],RESET:{actions:["resetTime"]}}},paused:{on:{RESUME:{target:"running"},RESET:{target:"idle",actions:["resetTime"]}}}},implementations:{effects:{keepTicking({prop:e,send:t}){return S(({deltaMs:r})=>{t({type:"TICK",deltaMs:r})},e("interval"))},waitForNextTick({send:e}){return w(()=>{e({type:"CONTINUE"})},0)}},actions:{updateTime({context:e,prop:t,event:r}){let a=t("countdown")?-1:1,s=O(r.deltaMs,t("interval"));e.set("currentMs",c=>{let i=c+a*s,o=t("targetMs");return o==null&&t("countdown")&&(o=0),t("countdown")&&o!=null?Math.max(i,o):!t("countdown")&&o!=null?Math.min(i,o):i})},resetTime({context:e,prop:t}){let r=t("targetMs");r==null&&t("countdown")&&(r=0),e.set("currentMs",t("startMs")??0)},invokeOnTick({context:e,prop:t,computed:r}){t("onTick")?.({value:e.get("currentMs"),time:r("time"),formattedTime:r("formattedTime")})},invokeOnComplete({prop:e}){e("onComplete")?.()}},guards:{hasReachedTarget:({context:e,prop:t})=>{let r=t("targetMs");if(r==null&&t("countdown")&&(r=0),r==null)return!1;let a=e.get("currentMs");return t("countdown")?a<=r:a>=r}}}};function q(e){let t=Math.max(0,e),r=t%1e3,a=Math.floor(t/1e3)%60,s=Math.floor(t/(1e3*60))%60,c=Math.floor(t/(1e3*60*60))%24;return{days:Math.floor(t/(1e3*60*60*24)),hours:c,minutes:s,seconds:a,milliseconds:r}}function $(e,t,r){let a=r-t;return a===0?0:(e-t)/a}function h(e,t=2){return e.toString().padStart(t,"0")}function O(e,t){return Math.floor(e/t)*t}function V(e){let{days:t,hours:r,minutes:a,seconds:s}=e;return{days:h(t),hours:h(r),minutes:h(a),seconds:h(s),milliseconds:h(e.milliseconds,3)}}function U(e){let{startMs:t,targetMs:r,countdown:a,interval:s}=e;if(s!=null&&(typeof s!="number"||s<=0))throw new Error(`[timer] Invalid interval: ${s}. Must be a positive number.`);if(t!=null&&(typeof t!="number"||t<0))throw new Error(`[timer] Invalid startMs: ${t}. Must be a non-negative number.`);if(r!=null&&(typeof r!="number"||r<0))throw new Error(`[timer] Invalid targetMs: ${r}. Must be a non-negative number.`);if(a&&t!=null&&r!=null&&t<=r)throw new Error(`[timer] Invalid countdown configuration: startMs (${t}) must be greater than targetMs (${r}).`);if(!a&&t!=null&&r!=null&&t>=r)throw new Error(`[timer] Invalid stopwatch configuration: startMs (${t}) must be less than targetMs (${r}).`);if(a&&r==null&&t!=null&&t<=0)throw new Error(`[timer] Invalid countdown configuration: startMs (${t}) must be greater than 0 when no targetMs is provided.`)}var D=b()(["autoStart","countdown","getRootNode","id","ids","interval","onComplete","onTick","startMs","targetMs"]),Q=P(D);var f=class extends R{initMachine(t){return new H(L,t)}initApi(){return C(this.machine.service,I)}render(){let t=this.el.querySelector('[data-scope="timer"][data-part="root"]')??this.el;this.spreadProps(t,this.api.getRootProps());let r=this.el.querySelector('[data-scope="timer"][data-part="area"]');r&&this.spreadProps(r,this.api.getAreaProps());let a=this.el.querySelector('[data-scope="timer"][data-part="control"]');a&&this.spreadProps(a,this.api.getControlProps()),["days","hours","minutes","seconds","milliseconds"].forEach(o=>{let l=this.el.querySelector(`[data-scope="timer"][data-part="item"][data-type="${o}"]`);l&&this.spreadProps(l,this.api.getItemProps({type:o}));let u=this.el.querySelector(`[data-scope="timer"][data-part="item-value"][data-type="${o}"]`);u&&this.spreadProps(u,this.api.getItemValueProps({type:o}));let g=this.el.querySelector(`[data-scope="timer"][data-part="item-label"][data-type="${o}"]`);g&&this.spreadProps(g,this.api.getItemLabelProps({type:o}))});let c=this.el.querySelector('[data-scope="timer"][data-part="separator"]');c&&this.spreadProps(c,this.api.getSeparatorProps()),["start","pause","resume","reset","restart"].forEach(o=>{let l=this.el.querySelector(`[data-scope="timer"][data-part="action-trigger"][data-action="${o}"]`);l&&this.spreadProps(l,this.api.getActionTriggerProps({action:o}))})}};var rt={mounted(){let e=this.el,t=new f(e,{id:e.id,countdown:p(e,"countdown"),startMs:d(e,"startMs"),targetMs:d(e,"targetMs"),autoStart:p(e,"autoStart"),interval:d(e,"interval")??1e3,onTick:r=>{let a=M(e,"onTick");a&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(a,{value:r.value,time:r.time,formattedTime:r.formattedTime,id:e.id})},onComplete:()=>{let r=M(e,"onComplete");r&&!this.liveSocket.main.isDead&&this.liveSocket.main.isConnected()&&this.pushEvent(r,{id:e.id})}});t.init(),this.timer=t,this.handlers=[]},updated(){this.timer?.updateProps({id:this.el.id,countdown:p(this.el,"countdown"),startMs:d(this.el,"startMs"),targetMs:d(this.el,"targetMs"),autoStart:p(this.el,"autoStart"),interval:d(this.el,"interval")??1e3})},destroyed(){if(this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.timer?.destroy()}};export{rt as Timer};
