import{e as de}from"./chunk-MMRG4CGO.mjs";import{Aa as q,B as he,Ba as W,Bb as Ve,Ca as Ee,Cb as ve,Da as L,Db as xe,E as ee,Ea as _,Eb as Se,Fa as P,Fb as U,Ga as j,Gb as B,Ha as te,I as F,Ib as $,K as A,L as fe,Na as ne,Oa as X,Pa as K,Q as ge,a as ue,ba as R,d as g,e as H,i as I,j as pe,nb as ae,sb as Ne,wb as me,xa as G,yb as oe}from"./chunk-IYURAQ6S.mjs";var Re=ue("tree-view").parts("branch","branchContent","branchControl","branchIndentGuide","branchIndicator","branchText","branchTrigger","item","itemIndicator","itemText","label","nodeCheckbox","nodeRenameInput","root","tree"),C=Re.build(),J=e=>new de(e);J.empty=()=>new de({rootNode:{children:[]}});var Le=e=>e.ids?.root??`tree:${e.id}:root`,Ce=e=>e.ids?.label??`tree:${e.id}:label`,se=(e,t)=>e.ids?.node?.(t)??`tree:${e.id}:node:${t}`,le=e=>e.ids?.tree??`tree:${e.id}:tree`,x=(e,t)=>{t!=null&&e.getById(se(e,t))?.focus()},be=(e,t)=>`tree:${e.id}:rename-input:${t}`,Te=(e,t)=>e.getById(be(e,t));function ye(e,t,n){let a=e.getNodeValue(t);if(!e.isBranchNode(t))return n.includes(a);let l=e.getDescendantValues(a),s=l.every(r=>n.includes(r)),d=l.some(r=>n.includes(r));return s?!0:d?"indeterminate":!1}function De(e,t,n){let a=e.getDescendantValues(t),l=a.every(s=>n.includes(s));return P(l?_(n,...a):L(n,...a))}function ke(e,t){let n=new Map;return e.visit({onEnter:a=>{let l=e.getNodeValue(a),s=e.isBranchNode(a),d=ye(e,a,t);n.set(l,{type:s?"branch":"leaf",checked:d})}}),n}function Ae(e,t){let{context:n,scope:a,computed:l,prop:s,send:d}=e,r=s("collection"),u=Array.from(n.get("expandedValue")),p=Array.from(n.get("selectedValue")),V=Array.from(n.get("checkedValue")),N=l("isTypingAhead"),v=n.get("focusedValue"),D=n.get("loadingStatus"),M=n.get("renamingValue"),E=({indexPath:i})=>r.getValuePath(i).slice(0,-1).some(c=>!u.includes(c)),S=r.getFirstNode(void 0,{skip:E}),T=S?r.getNodeValue(S):null;function m(i){let{node:o,indexPath:c}=i,h=r.getNodeValue(o);return{id:se(a,h),value:h,indexPath:c,valuePath:r.getValuePath(c),disabled:!!o.disabled,focused:v==null?T===h:v===h,selected:p.includes(h),expanded:u.includes(h),loading:D[h]==="loading",depth:c.length,isBranch:r.isBranchNode(o),renaming:M===h,get checked(){return ye(r,o,V)}}}return{collection:r,expandedValue:u,selectedValue:p,checkedValue:V,toggleChecked(i,o){d({type:"CHECKED.TOGGLE",value:i,isBranch:o})},setChecked(i){d({type:"CHECKED.SET",value:i})},clearChecked(){d({type:"CHECKED.CLEAR"})},getCheckedMap(){return ke(r,V)},expand(i){d({type:i?"BRANCH.EXPAND":"EXPANDED.ALL",value:i})},collapse(i){d({type:i?"BRANCH.COLLAPSE":"EXPANDED.CLEAR",value:i})},deselect(i){d({type:i?"NODE.DESELECT":"SELECTED.CLEAR",value:i})},select(i){d({type:i?"NODE.SELECT":"SELECTED.ALL",value:i,isTrusted:!1})},getVisibleNodes(){return l("visibleNodes")},focus(i){x(a,i)},selectParent(i){let o=r.getParentNode(i);if(!o)return;let c=L(p,r.getNodeValue(o));d({type:"SELECTED.SET",value:c,src:"select.parent"})},expandParent(i){let o=r.getParentNode(i);if(!o)return;let c=L(u,r.getNodeValue(o));d({type:"EXPANDED.SET",value:c,src:"expand.parent"})},setExpandedValue(i){let o=P(i);d({type:"EXPANDED.SET",value:o})},setSelectedValue(i){let o=P(i);d({type:"SELECTED.SET",value:o})},startRenaming(i){d({type:"NODE.RENAME",value:i})},submitRenaming(i,o){d({type:"RENAME.SUBMIT",value:i,label:o})},cancelRenaming(){d({type:"RENAME.CANCEL"})},getRootProps(){return t.element({...C.root.attrs,id:Le(a),dir:s("dir")})},getLabelProps(){return t.element({...C.label.attrs,id:Ce(a),dir:s("dir")})},getTreeProps(){return t.element({...C.tree.attrs,id:le(a),dir:s("dir"),role:"tree","aria-label":"Tree View","aria-labelledby":Ce(a),"aria-multiselectable":s("selectionMode")==="multiple"||void 0,tabIndex:-1,onKeyDown(i){if(i.defaultPrevented||ee(i))return;let o=he(i);if(pe(o))return;let c=o?.closest("[data-part=branch-control], [data-part=item]");if(!c)return;let h=c.dataset.value;if(h==null){console.warn("[zag-js/tree-view] Node id not found for node",c);return}let k=c.matches("[data-part=branch-control]"),O={ArrowDown(f){A(f)||(f.preventDefault(),d({type:"NODE.ARROW_DOWN",id:h,shiftKey:f.shiftKey}))},ArrowUp(f){A(f)||(f.preventDefault(),d({type:"NODE.ARROW_UP",id:h,shiftKey:f.shiftKey}))},ArrowLeft(f){A(f)||c.dataset.disabled||(f.preventDefault(),d({type:k?"BRANCH_NODE.ARROW_LEFT":"NODE.ARROW_LEFT",id:h}))},ArrowRight(f){!k||c.dataset.disabled||(f.preventDefault(),d({type:"BRANCH_NODE.ARROW_RIGHT",id:h}))},Home(f){A(f)||(f.preventDefault(),d({type:"NODE.HOME",id:h,shiftKey:f.shiftKey}))},End(f){A(f)||(f.preventDefault(),d({type:"NODE.END",id:h,shiftKey:f.shiftKey}))},Space(f){c.dataset.disabled||(N?d({type:"TREE.TYPEAHEAD",key:f.key}):O.Enter?.(f))},Enter(f){c.dataset.disabled||I(o)&&A(f)||(d({type:k?"BRANCH_NODE.CLICK":"NODE.CLICK",id:h,src:"keyboard"}),I(o)||f.preventDefault())},"*"(f){c.dataset.disabled||(f.preventDefault(),d({type:"SIBLINGS.EXPAND",id:h}))},a(f){!f.metaKey||c.dataset.disabled||(f.preventDefault(),d({type:"SELECTED.ALL",moveFocus:!0}))},F2(f){if(c.dataset.disabled)return;let re=s("canRename");if(!re)return;let z=r.getIndexPath(h);if(z){let ce=r.at(z);if(ce&&!re(ce,z))return}f.preventDefault(),d({type:"NODE.RENAME",value:h})}},Z=fe(i,{dir:s("dir")}),ie=O[Z];if(ie){ie(i);return}G.isValidEvent(i)&&(d({type:"TREE.TYPEAHEAD",key:i.key,id:h}),i.preventDefault())}})},getNodeState:m,getItemProps(i){let o=m(i);return t.element({...C.item.attrs,id:o.id,dir:s("dir"),"data-ownedby":le(a),"data-path":i.indexPath.join("/"),"data-value":o.value,tabIndex:o.focused?0:-1,"data-focus":g(o.focused),role:"treeitem","aria-current":o.selected?"true":void 0,"aria-selected":o.disabled?void 0:o.selected,"data-selected":g(o.selected),"aria-disabled":H(o.disabled),"data-disabled":g(o.disabled),"data-renaming":g(o.renaming),"aria-level":o.depth,"data-depth":o.depth,style:{"--depth":o.depth},onFocus(c){c.stopPropagation(),d({type:"NODE.FOCUS",id:o.value})},onClick(c){if(o.disabled||!F(c)||I(c.currentTarget)&&A(c))return;let h=c.metaKey||c.ctrlKey;d({type:"NODE.CLICK",id:o.value,shiftKey:c.shiftKey,ctrlKey:h}),c.stopPropagation(),I(c.currentTarget)||c.preventDefault()}})},getItemTextProps(i){let o=m(i);return t.element({...C.itemText.attrs,"data-disabled":g(o.disabled),"data-selected":g(o.selected),"data-focus":g(o.focused)})},getItemIndicatorProps(i){let o=m(i);return t.element({...C.itemIndicator.attrs,"aria-hidden":!0,"data-disabled":g(o.disabled),"data-selected":g(o.selected),"data-focus":g(o.focused),hidden:!o.selected})},getBranchProps(i){let o=m(i);return t.element({...C.branch.attrs,"data-depth":o.depth,dir:s("dir"),"data-branch":o.value,role:"treeitem","data-ownedby":le(a),"data-value":o.value,"aria-level":o.depth,"aria-selected":o.disabled?void 0:o.selected,"data-path":i.indexPath.join("/"),"data-selected":g(o.selected),"aria-expanded":o.expanded,"data-state":o.expanded?"open":"closed","aria-disabled":H(o.disabled),"data-disabled":g(o.disabled),"data-loading":g(o.loading),"aria-busy":H(o.loading),style:{"--depth":o.depth}})},getBranchIndicatorProps(i){let o=m(i);return t.element({...C.branchIndicator.attrs,"aria-hidden":!0,"data-state":o.expanded?"open":"closed","data-disabled":g(o.disabled),"data-selected":g(o.selected),"data-focus":g(o.focused),"data-loading":g(o.loading)})},getBranchTriggerProps(i){let o=m(i);return t.element({...C.branchTrigger.attrs,role:"button",dir:s("dir"),"data-disabled":g(o.disabled),"data-state":o.expanded?"open":"closed","data-value":o.value,"data-loading":g(o.loading),disabled:o.loading,onClick(c){o.disabled||o.loading||(d({type:"BRANCH_TOGGLE.CLICK",id:o.value}),c.stopPropagation())}})},getBranchControlProps(i){let o=m(i);return t.element({...C.branchControl.attrs,role:"button",id:o.id,dir:s("dir"),tabIndex:o.focused?0:-1,"data-path":i.indexPath.join("/"),"data-state":o.expanded?"open":"closed","data-disabled":g(o.disabled),"data-selected":g(o.selected),"data-focus":g(o.focused),"data-renaming":g(o.renaming),"data-value":o.value,"data-depth":o.depth,"data-loading":g(o.loading),"aria-busy":H(o.loading),onFocus(c){d({type:"NODE.FOCUS",id:o.value}),c.stopPropagation()},onClick(c){if(o.disabled||o.loading||!F(c)||I(c.currentTarget)&&A(c))return;let h=c.metaKey||c.ctrlKey;d({type:"BRANCH_NODE.CLICK",id:o.value,shiftKey:c.shiftKey,ctrlKey:h}),c.stopPropagation()}})},getBranchTextProps(i){let o=m(i);return t.element({...C.branchText.attrs,dir:s("dir"),"data-disabled":g(o.disabled),"data-state":o.expanded?"open":"closed","data-loading":g(o.loading)})},getBranchContentProps(i){let o=m(i);return t.element({...C.branchContent.attrs,role:"group",dir:s("dir"),"data-state":o.expanded?"open":"closed","data-depth":o.depth,"data-path":i.indexPath.join("/"),"data-value":o.value,hidden:!o.expanded})},getBranchIndentGuideProps(i){let o=m(i);return t.element({...C.branchIndentGuide.attrs,"data-depth":o.depth})},getNodeCheckboxProps(i){let o=m(i),c=o.checked;return t.element({...C.nodeCheckbox.attrs,tabIndex:-1,role:"checkbox","data-state":c===!0?"checked":c===!1?"unchecked":"indeterminate","aria-checked":c===!0?"true":c===!1?"false":"mixed","data-disabled":g(o.disabled),onClick(h){if(h.defaultPrevented||o.disabled||!F(h))return;d({type:"CHECKED.TOGGLE",value:o.value,isBranch:o.isBranch}),h.stopPropagation(),h.currentTarget.closest("[role=treeitem]")?.focus({preventScroll:!0})}})},getNodeRenameInputProps(i){let o=m(i);return t.input({...C.nodeRenameInput.attrs,id:be(a,o.value),type:"text","aria-label":"Rename tree item",hidden:!o.renaming,onKeyDown(c){ee(c)||(c.key==="Escape"&&(d({type:"RENAME.CANCEL"}),c.preventDefault()),c.key==="Enter"&&(d({type:"RENAME.SUBMIT",label:c.currentTarget.value}),c.preventDefault()),c.stopPropagation())},onBlur(c){d({type:"RENAME.SUBMIT",label:c.currentTarget.value})}})}}}function Y(e,t){let{context:n,prop:a,refs:l}=e;if(!a("loadChildren")){n.set("expandedValue",E=>P(L(E,...t)));return}let s=n.get("loadingStatus"),[d,r]=ne(t,E=>s[E]==="loaded");if(d.length>0&&n.set("expandedValue",E=>P(L(E,...d))),r.length===0)return;let u=a("collection"),[p,V]=ne(r,E=>{let S=u.findNode(E);return u.getNodeChildren(S).length>0});if(p.length>0&&n.set("expandedValue",E=>P(L(E,...p))),V.length===0)return;n.set("loadingStatus",E=>({...E,...V.reduce((S,T)=>({...S,[T]:"loading"}),{})}));let N=V.map(E=>{let S=u.getIndexPath(E),T=u.getValuePath(S),m=u.findNode(E);return{id:E,indexPath:S,valuePath:T,node:m}}),v=l.get("pendingAborts"),D=a("loadChildren");Ne(D,()=>"[zag-js/tree-view] `loadChildren` is required for async expansion");let M=N.map(({id:E,indexPath:S,valuePath:T,node:m})=>{let i=v.get(E);i&&(i.abort(),v.delete(E));let o=new AbortController;return v.set(E,o),D({valuePath:T,indexPath:S,node:m,signal:o.signal})});Promise.allSettled(M).then(E=>{let S=[],T=[],m=n.get("loadingStatus"),i=a("collection");E.forEach((o,c)=>{let{id:h,indexPath:k,node:O,valuePath:Z}=N[c];o.status==="fulfilled"?(m[h]="loaded",S.push(h),i=i.replace(k,{...O,children:o.value})):(v.delete(h),Reflect.deleteProperty(m,h),T.push({node:O,error:o.reason,indexPath:k,valuePath:Z}))}),n.set("loadingStatus",m),S.length&&(n.set("expandedValue",o=>P(L(o,...S))),a("onLoadChildrenComplete")?.({collection:i})),T.length&&a("onLoadChildrenError")?.({nodes:T})})}function b(e){let{prop:t,context:n}=e;return function({indexPath:l}){return t("collection").getValuePath(l).slice(0,-1).some(d=>!n.get("expandedValue").includes(d))}}var{and:y}=me(),Pe={props({props:e}){return{selectionMode:"single",collection:J.empty(),typeahead:!0,expandOnClick:!0,defaultExpandedValue:[],defaultSelectedValue:[],...e}},initialState(){return"idle"},context({prop:e,bindable:t,getContext:n}){return{expandedValue:t(()=>({defaultValue:e("defaultExpandedValue"),value:e("expandedValue"),isEqual:X,onChange(a){let s=n().get("focusedValue");e("onExpandedChange")?.({expandedValue:a,focusedValue:s,get expandedNodes(){return e("collection").findNodes(a)}})}})),selectedValue:t(()=>({defaultValue:e("defaultSelectedValue"),value:e("selectedValue"),isEqual:X,onChange(a){let s=n().get("focusedValue");e("onSelectionChange")?.({selectedValue:a,focusedValue:s,get selectedNodes(){return e("collection").findNodes(a)}})}})),focusedValue:t(()=>({defaultValue:e("defaultFocusedValue")||null,value:e("focusedValue"),onChange(a){e("onFocusChange")?.({focusedValue:a,get focusedNode(){return a?e("collection").findNode(a):null}})}})),loadingStatus:t(()=>({defaultValue:{}})),checkedValue:t(()=>({defaultValue:e("defaultCheckedValue")||[],value:e("checkedValue"),isEqual:X,onChange(a){e("onCheckedChange")?.({checkedValue:a})}})),renamingValue:t(()=>({sync:!0,defaultValue:null}))}},refs(){return{typeaheadState:{...G.defaultOptions},pendingAborts:new Map}},computed:{isMultipleSelection:({prop:e})=>e("selectionMode")==="multiple",isTypingAhead:({refs:e})=>e.get("typeaheadState").keysSoFar.length>0,visibleNodes:({prop:e,context:t})=>{let n=[];return e("collection").visit({skip:b({prop:e,context:t}),onEnter:(a,l)=>{n.push({node:a,indexPath:l})}}),n}},on:{"EXPANDED.SET":{actions:["setExpanded"]},"EXPANDED.CLEAR":{actions:["clearExpanded"]},"EXPANDED.ALL":{actions:["expandAllBranches"]},"BRANCH.EXPAND":{actions:["expandBranches"]},"BRANCH.COLLAPSE":{actions:["collapseBranches"]},"SELECTED.SET":{actions:["setSelected"]},"SELECTED.ALL":[{guard:y("isMultipleSelection","moveFocus"),actions:["selectAllNodes","focusTreeLastNode"]},{guard:"isMultipleSelection",actions:["selectAllNodes"]}],"SELECTED.CLEAR":{actions:["clearSelected"]},"NODE.SELECT":{actions:["selectNode"]},"NODE.DESELECT":{actions:["deselectNode"]},"CHECKED.TOGGLE":{actions:["toggleChecked"]},"CHECKED.SET":{actions:["setChecked"]},"CHECKED.CLEAR":{actions:["clearChecked"]},"NODE.FOCUS":{actions:["setFocusedNode"]},"NODE.ARROW_DOWN":[{guard:y("isShiftKey","isMultipleSelection"),actions:["focusTreeNextNode","extendSelectionToNextNode"]},{actions:["focusTreeNextNode"]}],"NODE.ARROW_UP":[{guard:y("isShiftKey","isMultipleSelection"),actions:["focusTreePrevNode","extendSelectionToPrevNode"]},{actions:["focusTreePrevNode"]}],"NODE.ARROW_LEFT":{actions:["focusBranchNode"]},"BRANCH_NODE.ARROW_LEFT":[{guard:"isBranchExpanded",actions:["collapseBranch"]},{actions:["focusBranchNode"]}],"BRANCH_NODE.ARROW_RIGHT":[{guard:y("isBranchFocused","isBranchExpanded"),actions:["focusBranchFirstNode"]},{actions:["expandBranch"]}],"SIBLINGS.EXPAND":{actions:["expandSiblingBranches"]},"NODE.HOME":[{guard:y("isShiftKey","isMultipleSelection"),actions:["extendSelectionToFirstNode","focusTreeFirstNode"]},{actions:["focusTreeFirstNode"]}],"NODE.END":[{guard:y("isShiftKey","isMultipleSelection"),actions:["extendSelectionToLastNode","focusTreeLastNode"]},{actions:["focusTreeLastNode"]}],"NODE.CLICK":[{guard:y("isCtrlKey","isMultipleSelection"),actions:["toggleNodeSelection"]},{guard:y("isShiftKey","isMultipleSelection"),actions:["extendSelectionToNode"]},{actions:["selectNode"]}],"BRANCH_NODE.CLICK":[{guard:y("isCtrlKey","isMultipleSelection"),actions:["toggleNodeSelection"]},{guard:y("isShiftKey","isMultipleSelection"),actions:["extendSelectionToNode"]},{guard:"expandOnClick",actions:["selectNode","toggleBranchNode"]},{actions:["selectNode"]}],"BRANCH_TOGGLE.CLICK":{actions:["toggleBranchNode"]},"TREE.TYPEAHEAD":{actions:["focusMatchedNode"]}},exit:["clearPendingAborts"],states:{idle:{on:{"NODE.RENAME":{target:"renaming",actions:["setRenamingValue"]}}},renaming:{entry:["syncRenameInput","focusRenameInput"],on:{"RENAME.SUBMIT":{guard:"isRenameLabelValid",target:"idle",actions:["submitRenaming"]},"RENAME.CANCEL":{target:"idle",actions:["cancelRenaming"]}}}},implementations:{guards:{isBranchFocused:({context:e,event:t})=>e.get("focusedValue")===t.id,isBranchExpanded:({context:e,event:t})=>e.get("expandedValue").includes(t.id),isShiftKey:({event:e})=>e.shiftKey,isCtrlKey:({event:e})=>e.ctrlKey,hasSelectedItems:({context:e})=>e.get("selectedValue").length>0,isMultipleSelection:({prop:e})=>e("selectionMode")==="multiple",moveFocus:({event:e})=>!!e.moveFocus,expandOnClick:({prop:e})=>!!e("expandOnClick"),isRenameLabelValid:({event:e})=>e.label.trim()!==""},actions:{selectNode({context:e,event:t}){let n=t.id||t.value;e.set("selectedValue",a=>n==null?a:!t.isTrusted&&K(n)?a.concat(...n):[K(n)?Ee(n):n].filter(Boolean))},deselectNode({context:e,event:t}){let n=q(t.id||t.value);e.set("selectedValue",a=>_(a,...n))},setFocusedNode({context:e,event:t}){e.set("focusedValue",t.id)},clearFocusedNode({context:e}){e.set("focusedValue",null)},clearSelectedItem({context:e}){e.set("selectedValue",[])},toggleBranchNode({context:e,event:t,action:n}){let a=e.get("expandedValue").includes(t.id);n(a?["collapseBranch"]:["expandBranch"])},expandBranch(e){let{event:t}=e;Y(e,[t.id])},expandBranches(e){let{context:t,event:n}=e,a=q(n.value);Y(e,j(a,t.get("expandedValue")))},collapseBranch({context:e,event:t}){e.set("expandedValue",n=>_(n,t.id))},collapseBranches(e){let{context:t,event:n}=e,a=q(n.value);t.set("expandedValue",l=>_(l,...a))},setExpanded({context:e,event:t}){K(t.value)&&e.set("expandedValue",t.value)},clearExpanded({context:e}){e.set("expandedValue",[])},setSelected({context:e,event:t}){K(t.value)&&e.set("selectedValue",t.value)},clearSelected({context:e}){e.set("selectedValue",[])},focusTreeFirstNode(e){let{prop:t,scope:n}=e,a=t("collection"),l=a.getFirstNode(void 0,{skip:b(e)});if(!l)return;let s=a.getNodeValue(l);w(e,s)?R(()=>x(n,s)):x(n,s)},focusTreeLastNode(e){let{prop:t,scope:n}=e,a=t("collection"),l=a.getLastNode(void 0,{skip:b(e)}),s=a.getNodeValue(l);w(e,s)?R(()=>x(n,s)):x(n,s)},focusBranchFirstNode(e){let{event:t,prop:n,scope:a}=e,l=n("collection"),s=l.findNode(t.id),d=l.getFirstNode(s,{skip:b(e)});if(!d)return;let r=l.getNodeValue(d);w(e,r)?R(()=>x(a,r)):x(a,r)},focusTreeNextNode(e){let{event:t,prop:n,scope:a}=e,l=n("collection"),s=l.getNextNode(t.id,{skip:b(e)});if(!s)return;let d=l.getNodeValue(s);w(e,d)?R(()=>x(a,d)):x(a,d)},focusTreePrevNode(e){let{event:t,prop:n,scope:a}=e,l=n("collection"),s=l.getPreviousNode(t.id,{skip:b(e)});if(!s)return;let d=l.getNodeValue(s);w(e,d)?R(()=>x(a,d)):x(a,d)},focusBranchNode(e){let{event:t,prop:n,scope:a}=e,l=n("collection"),s=l.getParentNode(t.id),d=s?l.getNodeValue(s):void 0;if(!d)return;w(e,d)?R(()=>x(a,d)):x(a,d)},selectAllNodes({context:e,prop:t}){e.set("selectedValue",t("collection").getValues())},focusMatchedNode(e){let{context:t,prop:n,refs:a,event:l,scope:s,computed:d}=e,u=d("visibleNodes").map(({node:N})=>({textContent:n("collection").stringifyNode(N),id:n("collection").getNodeValue(N)})),p=G(u,{state:a.get("typeaheadState"),activeId:t.get("focusedValue"),key:l.key});if(!p?.id)return;w(e,p.id)?R(()=>x(s,p.id)):x(s,p.id)},toggleNodeSelection({context:e,event:t}){let n=te(e.get("selectedValue"),t.id);e.set("selectedValue",n)},expandAllBranches(e){let{context:t,prop:n}=e,a=n("collection").getBranchValues(),l=j(a,t.get("expandedValue"));Y(e,l)},expandSiblingBranches(e){let{context:t,event:n,prop:a}=e,l=a("collection"),s=l.getIndexPath(n.id);if(!s)return;let r=l.getSiblingNodes(s).map(p=>l.getNodeValue(p)),u=j(r,t.get("expandedValue"));Y(e,u)},extendSelectionToNode(e){let{context:t,event:n,prop:a,computed:l}=e,s=a("collection"),d=W(t.get("selectedValue"))||s.getNodeValue(s.getFirstNode()),r=n.id,u=[d,r],p=0;l("visibleNodes").forEach(({node:N})=>{let v=s.getNodeValue(N);p===1&&u.push(v),(v===d||v===r)&&p++}),t.set("selectedValue",P(u))},extendSelectionToNextNode(e){let{context:t,event:n,prop:a}=e,l=a("collection"),s=l.getNextNode(n.id,{skip:b(e)});if(!s)return;let d=new Set(t.get("selectedValue")),r=l.getNodeValue(s);r!=null&&(d.has(n.id)&&d.has(r)?d.delete(n.id):d.has(r)||d.add(r),t.set("selectedValue",Array.from(d)))},extendSelectionToPrevNode(e){let{context:t,event:n,prop:a}=e,l=a("collection"),s=l.getPreviousNode(n.id,{skip:b(e)});if(!s)return;let d=new Set(t.get("selectedValue")),r=l.getNodeValue(s);r!=null&&(d.has(n.id)&&d.has(r)?d.delete(n.id):d.has(r)||d.add(r),t.set("selectedValue",Array.from(d)))},extendSelectionToFirstNode(e){let{context:t,prop:n}=e,a=n("collection"),l=W(t.get("selectedValue")),s=[];a.visit({skip:b(e),onEnter:d=>{let r=a.getNodeValue(d);if(s.push(r),r===l)return"stop"}}),t.set("selectedValue",s)},extendSelectionToLastNode(e){let{context:t,prop:n}=e,a=n("collection"),l=W(t.get("selectedValue")),s=[],d=!1;a.visit({skip:b(e),onEnter:r=>{let u=a.getNodeValue(r);u===l&&(d=!0),d&&s.push(u)}}),t.set("selectedValue",s)},clearPendingAborts({refs:e}){let t=e.get("pendingAborts");t.forEach(n=>n.abort()),t.clear()},toggleChecked({context:e,event:t,prop:n}){let a=n("collection");e.set("checkedValue",l=>t.isBranch?De(a,t.value,l):te(l,t.value))},setChecked({context:e,event:t}){e.set("checkedValue",t.value)},clearChecked({context:e}){e.set("checkedValue",[])},setRenamingValue({context:e,event:t,prop:n}){e.set("renamingValue",t.value);let a=n("onRenameStart");if(a){let l=n("collection"),s=l.getIndexPath(t.value);if(s){let d=l.at(s);d&&a({value:t.value,node:d,indexPath:s})}}},submitRenaming({context:e,event:t,prop:n,scope:a}){let l=e.get("renamingValue");if(!l)return;let d=n("collection").getIndexPath(l);if(!d)return;let r=t.label.trim(),u=n("onBeforeRename");if(u&&!u({value:l,label:r,indexPath:d})){e.set("renamingValue",null),x(a,l);return}n("onRenameComplete")?.({value:l,label:r,indexPath:d}),e.set("renamingValue",null),x(a,l)},cancelRenaming({context:e,scope:t}){let n=e.get("renamingValue");e.set("renamingValue",null),n&&x(t,n)},syncRenameInput({context:e,scope:t,prop:n}){let a=e.get("renamingValue");if(!a)return;let l=n("collection"),s=l.findNode(a);if(!s)return;let d=l.stringifyNode(s),r=Te(t,a);ge(r,d)},focusRenameInput({context:e,scope:t}){let n=e.get("renamingValue");if(!n)return;let a=Te(t,n);a&&(a.focus(),a.select())}}}};function w(e,t){let{prop:n,scope:a,computed:l}=e,s=n("scrollToIndexFn");if(!s)return!1;let d=n("collection"),r=l("visibleNodes");for(let u=0;u<r.length;u++){let{node:p,indexPath:V}=r[u];if(d.getNodeValue(p)===t)return s({index:u,node:p,indexPath:V,getElement:()=>a.getById(se(a,t))}),!0}return!1}var Be=oe()(["ids","collection","dir","expandedValue","expandOnClick","defaultFocusedValue","focusedValue","getRootNode","id","onExpandedChange","onFocusChange","onSelectionChange","checkedValue","selectedValue","selectionMode","typeahead","defaultExpandedValue","defaultSelectedValue","defaultCheckedValue","onCheckedChange","onLoadChildrenComplete","onLoadChildrenError","loadChildren","canRename","onRenameStart","onBeforeRename","onRenameComplete","scrollToIndexFn"]),We=ae(Be),we=oe()(["node","indexPath"]),je=ae(we);function Ie(e){let n=e.querySelectorAll('[data-scope="tree-view"][data-part="branch"], [data-scope="tree-view"][data-part="item"]'),a=[];for(let s of n){let d=s.getAttribute("data-path"),r=s.getAttribute("data-value");if(d==null||r==null)continue;let u=d.split("/").map(N=>parseInt(N,10));if(u.some(Number.isNaN))continue;let p=s.getAttribute("data-name")??r,V=s.getAttribute("data-part")==="branch";a.push({pathArr:u,id:r,name:p,isBranch:V})}a.sort((s,d)=>{let r=Math.min(s.pathArr.length,d.pathArr.length);for(let u=0;u<r;u++)if(s.pathArr[u]!==d.pathArr[u])return s.pathArr[u]-d.pathArr[u];return s.pathArr.length-d.pathArr.length});let l={id:"ROOT",name:"",children:[]};for(let{pathArr:s,id:d,name:r,isBranch:u}of a){let p=l;for(let N=0;N<s.length-1;N++){let v=s[N];p.children||(p.children=[]),p=p.children[v]}let V=s[s.length-1];p.children||(p.children=[]),p.children[V]=u?{id:d,name:r,children:[]}:{id:d,name:r}}return l}var Q=class extends xe{treeCollection;constructor(t,n){let a=n.treeData??Ie(t),l=J({nodeToValue:s=>s.id,nodeToString:s=>s.name,rootNode:a});super(t,{...n,collection:l}),this.treeCollection=l}initMachine(t){return new ve(Pe,{...t})}initApi(){return Ae(this.machine.service,Ve)}getNodeAt(t){if(t.length===0)return;let n=this.treeCollection.rootNode;for(let a of t)if(n=n?.children?.[a],!n)return;return n}updateExistingTree(t){this.spreadProps(t,this.api.getTreeProps());let n=t.querySelectorAll('[data-scope="tree-view"][data-part="branch"]');for(let l of n){let s=l.getAttribute("data-path");if(s==null)continue;let d=s.split("/").map(M=>parseInt(M,10)),r=this.getNodeAt(d);if(!r)continue;let u={indexPath:d,node:r};this.spreadProps(l,this.api.getBranchProps(u));let p=l.querySelector('[data-scope="tree-view"][data-part="branch-control"]');p&&this.spreadProps(p,this.api.getBranchControlProps(u));let V=l.querySelector('[data-scope="tree-view"][data-part="branch-text"]');V&&this.spreadProps(V,this.api.getBranchTextProps(u));let N=l.querySelector('[data-scope="tree-view"][data-part="branch-indicator"]');N&&this.spreadProps(N,this.api.getBranchIndicatorProps(u));let v=l.querySelector('[data-scope="tree-view"][data-part="branch-content"]');v&&this.spreadProps(v,this.api.getBranchContentProps(u));let D=l.querySelector('[data-scope="tree-view"][data-part="branch-indent-guide"]');D&&this.spreadProps(D,this.api.getBranchIndentGuideProps(u))}let a=t.querySelectorAll('[data-scope="tree-view"][data-part="item"]');for(let l of a){let s=l.getAttribute("data-path");if(s==null)continue;let d=s.split("/").map(p=>parseInt(p,10)),r=this.getNodeAt(d);if(!r)continue;let u={indexPath:d,node:r};this.spreadProps(l,this.api.getItemProps(u))}}syncTree=()=>{let t=this.el.querySelector('[data-scope="tree-view"][data-part="tree"]');t&&(this.spreadProps(t,this.api.getTreeProps()),this.updateExistingTree(t))};render(){let t=this.el.querySelector('[data-scope="tree-view"][data-part="root"]')??this.el;this.spreadProps(t,this.api.getRootProps());let n=this.el.querySelector('[data-scope="tree-view"][data-part="label"]');n&&this.spreadProps(n,this.api.getLabelProps()),this.syncTree()}};var ze={mounted(){let e=this.el,t=this.pushEvent.bind(this),n=new Q(e,{id:e.id,...$(e,"controlled")?{expandedValue:B(e,"expandedValue"),selectedValue:B(e,"selectedValue")}:{defaultExpandedValue:B(e,"defaultExpandedValue"),defaultSelectedValue:B(e,"defaultSelectedValue")},selectionMode:U(e,"selectionMode",["single","multiple"])??"single",dir:Se(e),onSelectionChange:a=>{let l=$(e,"redirect"),s=a.selectedValue?.length?a.selectedValue[0]:void 0,d=[...e.querySelectorAll('[data-scope="tree-view"][data-part="item"], [data-scope="tree-view"][data-part="branch"]')].find(v=>v.getAttribute("data-value")===s),r=d?.getAttribute("data-part")==="item",u=d?.getAttribute("data-redirect"),p=d?.hasAttribute("data-new-tab");l&&s&&r&&this.liveSocket.main.isDead&&u!=="false"&&(p?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s);let N=U(e,"onSelectionChange");N&&this.liveSocket.main.isConnected()&&t(N,{id:e.id,value:{...a,isItem:r??!1}})},onExpandedChange:a=>{let l=U(e,"onExpandedChange");l&&this.liveSocket.main.isConnected()&&t(l,{id:e.id,value:a})}});n.init(),this.treeView=n,this.onSetExpandedValue=a=>{let{value:l}=a.detail;n.api.setExpandedValue(l)},e.addEventListener("phx:tree-view:set-expanded-value",this.onSetExpandedValue),this.onSetSelectedValue=a=>{let{value:l}=a.detail;n.api.setSelectedValue(l)},e.addEventListener("phx:tree-view:set-selected-value",this.onSetSelectedValue),this.handlers=[],this.handlers.push(this.handleEvent("tree_view_set_expanded_value",a=>{let l=a.tree_view_id;l&&e.id!==l&&e.id!==`tree-view:${l}`||n.api.setExpandedValue(a.value)})),this.handlers.push(this.handleEvent("tree_view_set_selected_value",a=>{let l=a.tree_view_id;l&&e.id!==l&&e.id!==`tree-view:${l}`||n.api.setSelectedValue(a.value)})),this.handlers.push(this.handleEvent("tree_view_expanded_value",()=>{t("tree_view_expanded_value_response",{value:n.api.expandedValue})})),this.handlers.push(this.handleEvent("tree_view_selected_value",()=>{t("tree_view_selected_value_response",{value:n.api.selectedValue})}))},updated(){$(this.el,"controlled")&&this.treeView?.updateProps({expandedValue:B(this.el,"expandedValue"),selectedValue:B(this.el,"selectedValue")})},destroyed(){if(this.onSetExpandedValue&&this.el.removeEventListener("phx:tree-view:set-expanded-value",this.onSetExpandedValue),this.onSetSelectedValue&&this.el.removeEventListener("phx:tree-view:set-selected-value",this.onSetSelectedValue),this.handlers)for(let e of this.handlers)this.removeHandleEvent(e);this.treeView?.destroy()}};export{ze as TreeView};
